---
title: Informe Estudio de Percepciones de Seguridad y Policías en Chile 
subtitle: Informe Ola 0
author:
  - name: Mónica M. Gerber
    affiliations:
      - name: Universidad Diego Portales
        department: Facultad de Psicología
  - name: Cristóbal Moya
    affiliations:
      - name: Universität Bielefeld,
        department: Departmento de Sociología; DIW Berlín
  - name: Nicolás Tobar
    affiliations:
      - name: Universidad de Chile
      
format: 
  titlepage-pdf:
    documentclass: scrbook
    classoption: ["oneside", "open=any"]
    number-sections: true
    toc: true
    lof: false
    lot: false
    titlepage: "bg-image"
    titlepage-bg-image: "img/corner_logo.png"
    titlepage-logo: "img/logos.png"
    titlepage-header: "The Publisher"
    titlepage-footer: |
      Página web del Observatorio de Violencia y Legitimidad Social\
      [www.oles.cl](https://oles2.netlify.app/)\
      Repositorio GitHub de este informe\
      [https://github.com/oles-cl/esep_presentations](https://github.com/oles-cl/esep_presentations)
    coverpage-include-file:
      - tex/copyright.tex
    coverpage: otter
    coverpage-bg-image: "img/portrait_0.png"
    coverpage-title: ""
    coverpage-author: ""
    fig-cap-location: top
    tbl-cap-location: top
    fig-width: 10
    fig-height: 7
    
execute: 
  echo: false
  warning: false
    
lang: es
---

```{r setup}
pacman::p_load(tidyverse,
               ggplot2,
               knitr,
               kableExtra,
               haven,
               labelled,
               sjlabelled,
               ggrepel,
               mdthemes,
               readxl,
               stringr,
               wrapr,
               scales,
               janitor,
               ggpubr,
               forcats,
               gt,
               stringr
               )

options(digits=1)

level_likert_1 <- c(
  "Muy en desacuerdo",
  "En desacuerdo",
  "Ni de acuerdo ni en desacuerdo",
  "De acuerdo",         
  "Muy de acuerdo",
  "NS-NR")

palette_likert_5 <- c(
  "#fde725",
  "#5ec962",
  "#3b528b",
  "#440154",
  "grey"
)

palette_oles_5 <- palette_likert_5

palette_oles_6 <- c(
  "#fde725",
  "#7ad151",
  "#2a788e",
  "#414487",
  "#440154",
  "grey"
  )

palette_likert_4 <-c(
  "#fde725",
  "#35b779",
  "#31688e",
  "#440154"
)

palette_oles_4 <-c(
  "#fde725",
  "#2a788e",
  "#440154",
  "grey"
)

palette_oles_3 <- c(
  "#fde725",
  "#440154",
  "grey"
)

palette_oles_2 <- c(
  "#fde725",
  "#440154"
)


# función demográficas sexo
plot_propbar_sexo <- function(x, fill_column, fill_palette) {
  x |>
  ggplot(aes(x = sexo, y = n, fill = !!as.name(fill_column))) +
    geom_bar(position = "fill", stat = "identity", color = "black", width = 0.6) +
    geom_text(aes(label = label), position = position_fill(vjust = 0.5), size = 4.5, color = "black") + # Aumenta el tamaño del texto
    coord_flip() +
    theme_classic() +
    theme(legend.position = "top",
          axis.title.x = element_blank(),
          axis.title.y = element_blank(),
          axis.text.x = element_text(size = 15),  # Aumenta el tamaño del eje X
          axis.text.y = element_text(size = 15),  # Aumenta el tamaño del eje Y
          legend.text = element_text(size = 12),  # Aumenta el tamaño de la leyenda de color
          legend.title = element_text(size = 1)) +  # No ver
    labs(fill = "") +
    scale_fill_manual(values = fill_palette) +
    scale_y_continuous(labels = function(x) paste0(x * 100, "%")) +
    guides(fill = guide_legend(reverse = TRUE))
}

# función demográficas edad
plot_propbar_edad <- function(x, fill_column, fill_palette) {
  x |>
  ggplot(aes(x = edad_recod, y = n, fill = !!as.name(fill_column))) +
    geom_bar(position = "fill", stat = "identity", color = "black", width = 0.6) +
    geom_text(aes(label = label), position = position_fill(vjust = 0.5), size = 4.5, color = "black") + # Aumenta el tamaño del texto
    coord_flip() +
    theme_classic() +
    theme(legend.position = "top",
          axis.title.x = element_blank(),
          axis.title.y = element_blank(),
          axis.text.x = element_text(size = 15),  # Aumenta el tamaño del eje X
          axis.text.y = element_text(size = 15),  # Aumenta el tamaño del eje Y
          legend.text = element_text(size = 12),  # Aumenta el tamaño de la leyenda de color
          legend.title = element_text(size = 1)) +  # No ver
    labs(fill = "") +
    scale_fill_manual(values = fill_palette) +
    scale_y_continuous(labels = function(x) paste0(x * 100, "%")) +
    guides(fill = guide_legend(reverse = TRUE))
}

# función propbar zona
plot_propbar_zona <- function(x, fill_column, fill_palette) {
  x |>
  ggplot(aes(x = zona, y = n, fill = !!as.name(fill_column))) +
    geom_bar(position = "fill", stat = "identity", color = "black", width = 0.6) +
    geom_text(aes(label = label), position = position_fill(vjust = 0.5), size = 4.5, color = "black") + # Aumenta el tamaño del texto
    coord_flip() +
    theme_classic() +
    theme(legend.position = "top",
          axis.title.x = element_blank(),
          axis.title.y = element_blank(),
          axis.text.x = element_text(size = 15),  # Aumenta el tamaño del eje X
          axis.text.y = element_text(size = 15),  # Aumenta el tamaño del eje Y
          legend.text = element_text(size = 12),  # Aumenta el tamaño de la leyenda de color
          legend.title = element_text(size = 1)) +  # Aumenta el tamaño del título de la leyenda
    labs(fill = "") +
    scale_fill_manual(values = fill_palette) +
    scale_y_continuous(labels = function(x) paste0(x * 100, "%")) +
    guides(fill = guide_legend(reverse = TRUE))
}

# función propbar gse
plot_propbar_gse <- function(x, fill_column, fill_palette) {
  x |>
  ggplot(aes(x = gse_recod, y = n, fill = !!as.name(fill_column))) +
    geom_bar(position = "fill", stat = "identity", color = "black", width = 0.6) +
    geom_text(aes(label = label), position = position_fill(vjust = 0.5), size = 4.5, color = "black") + # Aumenta el tamaño del texto
    coord_flip() +
    theme_classic() +
    theme(legend.position = "top",
          axis.title.x = element_blank(),
          axis.title.y = element_blank(),
          axis.text.x = element_text(size = 15),  # Aumenta el tamaño del eje X
          axis.text.y = element_text(size = 15),  # Aumenta el tamaño del eje Y
          legend.text = element_text(size = 12),  # Aumenta el tamaño de la leyenda de color
          legend.title = element_text(size = 1)) +  # No ver
    labs(fill = "") +
    scale_fill_manual(values = fill_palette) +
    scale_y_continuous(labels = function(x) paste0(x * 100, "%")) +
    guides(fill = guide_legend(reverse = TRUE))
}



#función base descriptivos
proc_plot_demo <- function(x, variable, demografico) {
  x %>%
    mutate({{ variable }} := to_label({{ variable }})) %>%
    drop_na({{ demografico }}) %>%
    group_by({{ demografico }}) %>%
    count({{ variable }}) %>%
    mutate(prop = round(n / sum(n) * 100, 0),
           ola = "Ola 0 (Septiembre-Noviembre 2023)",
           label=ifelse(prop>9,paste0(prop,"%"),NA))
}

data_ola0 <- readRDS("../data/esep_w0.rds") |>
  janitor::clean_names()|>
   rename(
         edad=edad_encuestado
         )|>
   mutate(edad_recod=case_when(edad <= 34 ~ "18 y 34 años",
                              edad > 34 & edad <= 54 ~ "35 y 54 años",
                              edad > 54 ~ "55 años o Más"),
          region=paste0(toupper(substr(region, 1, 1)),tolower(substr(region, 2, nchar(region)))),
          zona=case_when(
            region%in%c("Arica y parinacota","Tarapacá","Antofagasta")~"Norte Grande",
            region%in%c("Coquimbo","Atacama")~"Norte Chico",
            region=="Metropolitana"~"Región Metropolitina",
            region%in%c("Valparaíso","Libertador bernardo o’higgins",
                        "Maule","Ñuble")~"Zona Central",
            region%in%c("Biobío","Araucanía","Los lagos","Los ríos")~"Zona Sur",
            region%in%c("Aysén","Magallanes")~"Zona Austral"
          ),
          zona=factor(zona,levels = c("Norte Grande",
                                      "Norte Chico",
                                      "Región Metropolitina",
                                      "Zona Central",
                                      "Zona Sur",
                                      "Zona Austral")),
          gse_recod=case_when(
            gse%in%c(6,5)~"E/D",
            gse%in%c(4,3)~"C2/C3",
            gse%in%c(2,1)~"ABC1",
            gse==7~NA_character_
          ),
          sexo=to_label(sexo),
          fecha=as.Date(fecha, format = "%Y/%m/%d"),
          month=format(fecha, "%B"),
          date_recod=case_when(
            month%in%c("May","June")~"Mayo-Junio 2023",
            month%in%c("July","August")~"Julio-Agosto 2023",
            month%in%c("September","October")~"Sept-Oct 2023",
            month%in%c("November","December")~"Nov-Dic 2023",
            month%in%c("January","February","March")~"Enero-Febrero 2024"
          ),
          date_recod=factor(date_recod,levels=c(
            "Mayo-Junio 2023",
            "Julio-Agosto 2023",
            "Sept-Oct 2023",
            "Nov-Dic 2023",
            "Enero-Febrero 2024"
          )
         )
        ) 
```

# Introducción

La agenda de seguridad y delincuencia se ha vuelto cada vez más relevante en el debate público nacional. Al respecto, estudios como la Encuesta Nacional de Seguridad Ciudadana (ENUSC) elaborada por el Instituto Nacional de Estadísticas (INE), así como el Índice de Paz Ciudadana hecho por la fundación Paz Ciudadana han levantado datos de suma relevancia para sumar evidencias y hallazgos a la complejidad que requiere tratar la percepción de la ciudadanía sobre el crimen, la sensación de inseguridad, la victimización, entre otros.

Sin embargo, a pesar del impacto público y la visibilidad de estos estudios, hay una ausencia de datos que aborden el problema de la seguridad desde la perspectiva de la relación entre la ciudadanía y las instituciones policiales de nuestro país. Una amplia diversidad de investigaciones en el área de las Ciencias Sociales han demostrado que el fomento de las buenas relaciones entre policías y ciudadanos promueve la cooperación mutua para el enfrentamiento de la delincuencia en una sociedad democrática. Preocupados de este fenómeno, el Observatorio de Violencia y Legitimidad Social se encuentra desarrollando un Estudio Longitudinal sobre Percepciones de Seguridad y Policías en Chile.

Con el fin poner al alcance el conocimiento generado, el presente documento busca poner a disposición los resultados de la primera ola de la encuesta en cuestión. En el *Informe del Estudio de Percepciones de Seguridad y Policías en Chile (ESEP) Ola 0* el usuario puede encontrar información acerca de nuestra organización, las especificaciones metodológicas del estudio, así como los resultados generales y cruces demográficos de la encuesta.

# ¿Qué es el Observatorio de Violencia y Legitimidad Social (OLES)?

El Observatorio de Violencia y Legitimidad Social (OLES) es una plataforma que desarrolla investigación colaborativa en temáticas relacionadas con la **violencia**, explorando sus sentidos, formas de justificación, así como diversas formas en que la sociedad chilena ha desarrollado procesos de construcción de **legitimidad social** frente a las autoridades, considerando el rol de la **justicia** como elemento clave en la comprensión de las transformaciones sociales que vive actualmente el país.

OLES agrupa a investigadores e investigadoras de diferentes disciplinas y universidades en Chile con el objetivo de aunar esfuerzos para contribuir a la comprensión de los mecanismos de legitimidad policial y justificación de la violencia mediante el desarrollo de investigaciones bajo criterios de Ciencia Abierta y en diálogo con actores sociales. Asimismo, la plataforma opera como un espacio de formación de estudiantes y jóvenes con intereses académicos.

OLES fue fundado el año 2020, en vistas de los casos de violencia policial y violencia en la protesta acontecidos durante el estallido social del año 2019. A partir de estos años, ha desarrollado múltiples publicaciones académicas, intervenciones en prensa y seminarios para aportar antecedentes y evidencia al debate sobre el resguardo de los derechos humanos, la relación ciudadanía-carabineros, y el control de la violencia en Chile. A futuro, se espera fortalecer el despliegue de políticas públicas en estos ámbitos.

Actualmente, OLES cuenta con el apoyo de la Universidad Diego Portales (UDP), la Universidad de O’Higgins (UOH), la Universidad Católica del Norte (UCN), la Universidad Central (UCEN), la Universidad de Chile (UCH), así como del Centro de Estudios de Conflicto y Cohesión Social (COES). También recibe financiamiento con fondos ANID a través de la adjucación de Fondecyt Regular (N°1221805) y Exploración (N°13220187).

Para más información, es posible revisar la [página web de OLES: www.oles.cl](https://oles2.netlify.app/post/page/2/)


![Seminario internacional sobre Inseguridad en América Latina organizado por OLES. Agosto 2023](../img/image_intro.jpg)

# ¿Qué es el Estudio de Percepciones de Seguridad y Policías en Chile?

El Estudio de Percepciones de Seguridad y Policías de Chile (ESEP) diseñado por el Observatorio de Violencia y Legitimidad Social tiene como objetivo conocer las percepciones de la ciudadanía sobre la delincuencia en el país, así como sobre la manera en que las personas se vinculan con las policías. 

El estudio considera la aplicación de una encuesta longitudinal, esto es, una encuesta donde los y las participantes reportan sus actitudes de manera regular para poder entender cómo estos fenómenos van cambiando en el tiempo. 

Los y las participantes en esta encuesta corresponden a hombres y mujeres de entre 18 y 65 años de edad, residentes de zonas urbanas del país. Los y las encuestados fueron seleccionados a través de un muestreo probabilístico polietápico para participar en este estudio. Con la participación en este estudio, los y las participantes contribuirán a una mejor comprensión de las percepciones de la ciudadanía sobre la seguridad en Chile, así como de lo que la ciudadanía espera de sus policías.

Este estudio se encuentra financiado por la Universidad Diego Portales y la Agencia Nacional de Investigación y Desarrollo (ANID) a través de los fondos Fondecyt Regular N. 1221805 y ANID Exploración N. 13220187. Además, la recopilación de datos fue realizado por la consultora Statcom Datavoz.

El estudio es dirigido por la Dra. Monica Gerber, profesora titular de la Facultad de Psicología de la Universidad Diego Portales. Para más información sobre el estudio, es posible revisar la página web de ESEP: [www.esep.cl](https://esep2.netlify.app/)

# Sobre la Ola 0

El trabajo de campo de la Ola 0 de ESEP fue realizado entre mayo del 2023 y febrero del 2024, en más de 115 comunas en Chile, a través de entrevistas cara a cara. Cuenta con un total de 5304 casos representativos de los habitantes de las zonas urbanas en Chile que tienen entre 18 y 65 años. El cuestionario considera una duración de entre 5 y 10 minutos, y cuenta con preguntas de caracterización sociodemográfica, percepción de seguridad y actitudes hacia las policías. Este estudio tuvo dos objetivos primordiales: levantar información sobre algunas dimensones fundamentales de seguridad y vinculación entre la ciudadanía y las policías, así como invitar a los y las encuestados a participar del estudio longitudinal que se realizará a continuación. El estudio longitudinal iniciará en el año 2024, con mediciones cada tres meses.

De acuerdo con los criterios de Ciencia Abierta, OLES se dispone a compartir los instrumentos de medición y las bases de datos del estudio en el [repositorio que aloja la página web](https://oles2.netlify.app/esep/).

## Muestra Ola 0

La Ola 0 fue diseñada a partir de un muestreo probabilístico por conglomerados representativo de las zonas urbanas a nivel nacional. La unidad de muestreo son manzanas. El trabajo de campo se llevó a cabo entre mayo y diciembre de 2023 en más de 115 comunas de Chile. La @tbl-sample despliega la distribución demográfica de la muestra.

```{r}
#| label: tbl-sample
#| tbl-cap: "Muestra Ola 0 ESEP"

rbind(
data_ola0|>
  count(Variable=sexo)|>
  mutate(
    prop = paste0(round(n / sum(n) * 100, 1), "%")
  ),

data_ola0|>
  count(Variable=edad_recod)|>
  mutate(
    prop = paste0(round(n / sum(n) * 100, 1), "%")
  ),

data_ola0|>
  count(Variable=to_label(gse))|>
  mutate(
    prop = paste0(round(n / sum(n) * 100, 1), "%")
  ),

data_ola0 %>%
  count(Variable=region) %>%
  mutate(order = case_when(
    Variable == "Arica y parinacota" ~ 1,
    Variable == "Tarapacá" ~ 2,
    Variable == "Antofagasta" ~ 3,
    Variable == "Atacama" ~ 4,
    Variable == "Coquimbo" ~ 5,
    Variable == "Valparaíso" ~ 6,
    Variable == "Metropolitana" ~ 7,
    Variable == "Libertador bernardo o’higgins" ~ 8,
    Variable == "Maule" ~ 9,
    Variable == "Ñuble" ~ 10,
    Variable == "Biobío" ~ 11,
    Variable == "Araucanía" ~ 12,
    Variable == "Los ríos" ~ 13,
    Variable == "Los lagos" ~ 14,
    Variable == "Aysén" ~ 15,
    Variable == "Magallanes" ~ 16
  ))|>
  arrange(-desc(order))|>
  select(-order)|>
  mutate(
    prop = paste0(round(n / sum(n) * 100, 1), "%")
  ))|>
  gt()|>
  tab_row_group(
    label = "Región",
    rows = 13:28
  )|>
   tab_row_group(
    label = "Grupo Socioeconómico",
    rows = 6:12
  )|>
  tab_row_group(
    label = "Género",
    rows = 1:2
  )|>
  tab_row_group(
    label = "Tramo de edad",
    rows = 3:5
  )|>
    cols_label(
    n = "Cantidad de participantes",
    prop = "Proporción de participantes"  
    )|>
  tab_options(
    table.border.top.color = "white",
    heading.title.font.size = px(16),
    column_labels.border.top.width = 3,
    column_labels.border.top.color = "black",
    column_labels.border.bottom.width = 3,
    column_labels.border.bottom.color = "black",
    table_body.border.bottom.color = "black",
    table.border.bottom.color = "white",
    table.width = pct(100),
    table.background.color = "white",
    table.font.size = 10
  ) |>
  # center column text
  cols_align(align="center")|>
  tab_style(
    style = list(
      # remove horizontal lines
      cell_borders(
        sides = c("top", "bottom"),
        color = "white",
        weight = px(1)
      ),
      #center text
      cell_text(
        align="center"
      ),
    # remove row striping in Markdown documents
    cell_fill(color = "white", alpha = NULL)
      ),
      #do this for all columns and rows
    locations = cells_body(
      columns = everything(),
      rows = everything()
    ))


```


El trabajo en terreno se realizó dentro de una serie de tensiones, acontecimientos y eventos mediáticos relacionados con la seguridad pública y las policías en Chile. Para entregar al lector una panorámica de los principales eventos e hitos ocurridos durante la medición del estudio, el equipo de OLES entrega una contextualización del escenario noticioso y administrativo sobre las policías en Chile.

# Percepciones sobre seguridad 

```{r}
#| label: fig-b1-long
#| fig-cap: "Pensando en la delincuencia, usted diría que durante los últimos 12 meses la delincuencia en el país..."
#| echo: false
#| warning: false

val_label(data_ola0$b1,99)<-"NS-NR"
val_label(data_ola0$b1,88)<-"NS-NR"

data_ola0 |>
    mutate(b1=to_label(b1))|>
  group_by(date_recod) |>
  count(b1) |>
  mutate(prop=(n/sum(n)*100)|>round(1))|>

  ggplot(aes(x=date_recod,y=prop,color=b1))+
  geom_point()+
  geom_line(aes(group=b1))+
  geom_text_repel(aes(label = paste0(prop,"%")),size=7)+
  theme_classic(base_size=20)+
  scale_y_continuous(labels = function(x) paste0(x, "%"),limits = c(0,100))+
  scale_x_discrete(labels = function(x) str_wrap(x, width = 10)) +
  theme(
    legend.position = "top",
    axis.title.x = element_blank(),
    axis.title.y = element_blank(),
    )+
  labs(caption = "Fuente: ESEP 2023, ola 0.",
       color="Respuesta")+
  scale_color_manual(values = palette_oles_4)
```

```{r}
#| label: fig-b1-demo
#| fig-cap: "Pensando en la delincuencia, usted diría que durante los últimos 12 meses la delincuencia en el país... (Cruce demográfico)"
#| echo: false
#| warning: false

ggarrange(

data_ola0 |> 
  proc_plot_demo(b1,sexo)|>
  mutate(b1=factor(b1,
                   levels=c("Disminuyó",
                            "Se mantuvo",
                            "Aumentó",
                            "NS-NR"))) |>
  plot_propbar_sexo(fill_column="b1",fill_palette=palette_oles_4),


data_ola0 |> 
  proc_plot_demo(b1,edad_recod)|>
  mutate(b1=factor(b1,
                   levels=c("Disminuyó",
                            "Se mantuvo",
                            "Aumentó",
                            "NS-NR"))) |>
  plot_propbar_edad(fill_column = "b1",fill_palette = palette_oles_4),

data_ola0 |>
  proc_plot_demo(b1,zona)|>
  mutate(b1=factor(b1,
                   levels=c("Disminuyó",
                            "Se mantuvo",
                            "Aumentó",
                            "NS-NR"))) |> 
  plot_propbar_zona(fill_column = "b1",fill_palette = palette_oles_4),

 data_ola0 |>
  proc_plot_demo(b1,gse_recod)|>
  mutate(b1=factor(b1,
                   levels=c("Disminuyó",
                            "Se mantuvo",
                            "Aumentó",
                            "NS-NR"))) |>
  plot_propbar_gse(fill_column = "b1",fill_palette = palette_oles_4),

ncol = 2, nrow = 2, align = "hv", 
          common.legend = TRUE
 
)|>
  annotate_figure(bottom=text_grob("Fuente: ESEP 2023, ola 0.",hjust = 1,x=1,size = 10))


```

```{r}
#| label: fig-b2-long
#| fig-cap: "¿Qué tan seguro/a se siente caminando solo/a por su barrio cuando ya está oscuro?"
#| echo: false
#| warning: false

val_label(data_ola0$b2,99)<-"NS-NR"
val_label(data_ola0$b2,88)<-"NS-NR"

data_ola0 |>
  mutate(b2=to_label(b2),
         b2=dplyr::recode(b2,"Muy inseguro/a" = "Inseguro/a + Muy inseguro/a",
                             "Inseguro/a" = "Inseguro/a + Muy inseguro/a",
                             "Seguro/a" = "Seguro/a + Muy seguro/a",
                             "Muy seguro/a" = "Seguro/a + Muy seguro/a")) |>
  group_by(date_recod)|>
  count(b2) |> 
  mutate(prop=(n/sum(n)*100)|>round(1))|>

  ggplot(aes(x=date_recod,y=prop,color=b2))+
  geom_point(size=3)+
  geom_line(aes(group=b2))+
  geom_text_repel(aes(label = paste0(prop,"%")),size=7)+
  scale_y_continuous(labels = function(x) paste0(x, "%"),limits = c(0,100))+
  scale_x_discrete(labels = function(x) str_wrap(x, width = 10)) +
  theme_classic(base_size=20)+
  theme(
    legend.position = "top",
    axis.title.x = element_blank(),
    axis.title.y = element_blank(),
    )+
  labs(caption = "Fuente: ESEP 2023, ola 0.",
       color="Respuesta")+
  scale_color_manual(values = palette_oles_3)
```

```{r}
#| label: fig-b2-demo
#| fig-cap: "¿Qué tan seguro/a se siente caminando solo/a por su barrio cuando ya está oscuro? (Cruce demográfico)"
#| echo: false
#| warning: false

ggarrange(

data_ola0 |> 
  proc_plot_demo(b2,sexo)|>
  mutate(b2=factor(b2,
                   levels=c("Muy inseguro/a",
                            "Inseguro/a",
                            "Seguro/a",
                            "Muy seguro/a",
                            "NS-NR"))) |>
  plot_propbar_sexo(fill_column="b2",fill_palette=palette_oles_5),


data_ola0 |> 
  proc_plot_demo(b2,edad_recod)|>
  mutate(b2=factor(b2,
                   levels=c("Muy inseguro/a",
                            "Inseguro/a",
                            "Seguro/a",
                            "Muy seguro/a",
                            "NS-NR"))) |>
  plot_propbar_edad(fill_column = "b2",fill_palette = palette_oles_5),

data_ola0 |>
  proc_plot_demo(b2,zona)|>
  mutate(b2=factor(b2,
                   levels=c("Muy inseguro/a",
                            "Inseguro/a",
                            "Seguro/a",
                            "Muy seguro/a",
                            "NS-NR"))) |> 
  plot_propbar_zona(fill_column = "b2",fill_palette = palette_oles_5),

 data_ola0 |>
  proc_plot_demo(b2,gse_recod)|>
  mutate(b2=factor(b2,
                   levels=c("Muy inseguro/a",
                            "Inseguro/a",
                            "Seguro/a",
                            "Muy seguro/a",
                            "NS-NR"))) |>
  plot_propbar_gse(fill_column = "b2",fill_palette = palette_oles_5),

ncol = 2, nrow = 2, align = "hv", 
          common.legend = TRUE
)|>
  annotate_figure(bottom=text_grob("Fuente: ESEP 2023, ola 0.",hjust = 1,x=1,size = 10))
```

# Eficacia de las policías

```{r}
#| label: fig-c-general
#| fig-cap: "Teniendo en cuenta su propia experiencia o lo que ha oído, ¿en qué medida se encuentra Ud. de acuerdo o en desacuerdo con las siguientes afirmaciones sobre Carabineros de Chile?"
#| fig-subcap:
#|   - "Carabineros logra controlar el problema de la delincuencia en Chile"
#|   - "Carabineros logra controlar el problema del narcotráfico en Chile"
#| layout-ncol: 1
#| echo: false
#| warning: false
#| fig-height: 4

val_label(data_ola0$c1_1,99)<-"NS-NR"
val_label(data_ola0$c1_1,88)<-"NS-NR"

data_ola0 |>
  mutate(c1_1=to_label(c1_1))|>
  count(Variable=c1_1)|>
  mutate(prop=(n/nrow(data_ola0)*100)|>round(1),
         Item="Carabineros logra controlar el problema de la delincuencia en Chile",
         Variable=factor(Variable,levels=c(
                          "Muy en desacuerdo",
                          "En desacuerdo",
                          "Ni de acuerdo ni en desacuerdo",
                          "De acuerdo",
                          "Muy de Acuerdo",
                           "NS-NR")))|>
  
  ggplot(aes(x=Variable,y=prop,fill=Variable))+
  geom_bar(position="dodge", stat="identity",color="black") +
  geom_text(aes(label=paste0(prop,"%")),
            vjust=-0.1,
            size=8) +
  theme_classic(base_size=20) +
  theme(axis.title.x = element_blank(),
        axis.title.y = element_blank())+
  scale_y_continuous(labels = function(x) paste0(x, "%"),limits = c(0,100))+
  scale_x_discrete(labels = function(x) str_wrap(x, width = 13))+
  scale_fill_manual(values = c("#440154","#440154","#440154",
                               "#440154","#440154","grey"))+
  guides(fill=FALSE)

val_label(data_ola0$c1_2,99)<-"NS-NR"
val_label(data_ola0$c1_2,88)<-"NS-NR"

data_ola0 |>
  count(Variable=to_label(c1_2))|>
  mutate(prop=(n/nrow(data_ola0)*100)|>round(1),
         Item="Carabineros logra controlar el problema del narcotráfico en Chile",
                  Variable=factor(Variable,levels=c(
                          "Muy en desacuerdo",
                          "En desacuerdo",
                          "Ni de acuerdo ni en desacuerdo",
                          "De acuerdo",
                          "Muy de Acuerdo",
                          "NS-NR"))) |>

  ggplot(aes(x=Variable,y=prop,fill=Variable))+
  geom_bar(position="dodge", stat="identity",color="black") +
  geom_text(aes(label=paste0(prop,"%")),
            vjust=-0.1,
            size=8) +
  theme_classic(base_size=20) +
  theme(axis.title.x = element_blank(),
        axis.title.y = element_blank())+
  scale_y_continuous(labels = function(x) paste0(x, "%"),limits = c(0,100))+
  scale_x_discrete(labels = function(x) str_wrap(x, width = 13))+
  scale_fill_manual(values=c("#fde725","#fde725","#fde725",
                              "#fde725","#fde725","grey"))+
  guides(fill=FALSE)

```

```{r}
#| echo: false
#| warning: false

val_label(data_ola0$c1_1,99)<-"NS-NR"
val_label(data_ola0$c1_1,88)<-"NS-NR"

val_label(data_ola0$c1_2,99)<-"NS-NR"
val_label(data_ola0$c1_2,88)<-"NS-NR"

val_label(data_ola0$c1_3,99)<-"NS-NR"
val_label(data_ola0$c1_3,88)<-"NS-NR"

val_label(data_ola0$c1_4,99)<-"NS-NR"
val_label(data_ola0$c1_4,88)<-"NS-NR"
```

```{r}
#| label: fig-c1_1-demo
#| fig-cap: "(Cruce demográfico) Carabineros logra controlar el problema de la delincuencia en Chile"
#| echo: false
#| warning: false

ggarrange(

data_ola0 |> 
  proc_plot_demo(c1_1, sexo) |>
  mutate(c1_1 = factor(c1_1,
                     levels = c(
                                "Muy en desacuerdo",
                                "En desacuerdo",
                                "Ni de acuerdo ni en desacuerdo",
                                "De acuerdo",
                                "Muy de Acuerdo",
                                "NS-NR"))) |>
  plot_propbar_sexo(fill_column = "c1_1", fill_palette = palette_oles_6),


data_ola0 |> 
  proc_plot_demo(c1_1, edad_recod) |>
  mutate(c1_1 = factor(c1_1,
                     levels = c(
                                "Muy en desacuerdo",
                                "En desacuerdo",
                                "Ni de acuerdo ni en desacuerdo",
                                "De acuerdo",
                                "Muy de Acuerdo",
                                "NS-NR"))) |>
  plot_propbar_edad(fill_column = "c1_1", fill_palette = palette_oles_6),

data_ola0 |>
  proc_plot_demo(c1_1, zona) |>
  mutate(c1_1 = factor(c1_1,
                     levels = c(
                                "Muy en desacuerdo",
                                "En desacuerdo",
                                "Ni de acuerdo ni en desacuerdo",
                                "De acuerdo",
                                "Muy de Acuerdo",
                                "NS-NR"))) |> 
  plot_propbar_zona(fill_column = "c1_1", fill_palette = palette_oles_6),

 data_ola0 |>
  proc_plot_demo(c1_1, gse_recod) |>
  mutate(c1_1 = factor(c1_1,
                     levels = c(
                                "Muy en desacuerdo",
                                "En desacuerdo",
                                "Ni de acuerdo ni en desacuerdo",
                                "De acuerdo",
                                "Muy de Acuerdo",
                                "NS-NR"))) |>
  plot_propbar_gse(fill_column = "c1_1", fill_palette = palette_oles_6),

ncol = 2, nrow = 2, align = "hv", 
common.legend = TRUE
)|>
  annotate_figure(bottom=text_grob("Fuente: ESEP 2023, ola 0.",hjust = 1,x=1,size = 10))


```

```{r}
#| label: fig-c1_2-demo
#| fig-cap: "(Cruce demográfico) Carabineros logra controlar el problema del narcotráfico en Chile"
#| echo: false
#| warning: false

ggarrange(

data_ola0 |> 
  proc_plot_demo(c1_2, sexo) |>
  mutate(c1_2 = factor(c1_2,
                     levels = c("Muy en desacuerdo",
                                "En desacuerdo",
                                "Ni de acuerdo ni en desacuerdo",
                                "De acuerdo",
                                "Muy de Acuerdo",
                                "NS-NR"))) |>
  plot_propbar_sexo(fill_column = "c1_2", fill_palette = palette_oles_6),


data_ola0 |> 
  proc_plot_demo(c1_2, edad_recod) |>
  mutate(c1_2 = factor(c1_2,
                     levels = c("Muy en desacuerdo",
                                "En desacuerdo",
                                "Ni de acuerdo ni en desacuerdo",
                                "De acuerdo",
                                "Muy de Acuerdo",
                                "NS-NR"))) |>
  plot_propbar_edad(fill_column = "c1_2", fill_palette = palette_oles_6),

data_ola0 |>
  proc_plot_demo(c1_2, zona) |>
  mutate(c1_2 = factor(c1_2,
                     levels = c("Muy en desacuerdo",
                                "En desacuerdo",
                                "Ni de acuerdo ni en desacuerdo",
                                "De acuerdo",
                                "Muy de Acuerdo",
                                "NS-NR"))) |> 
  plot_propbar_zona(fill_column = "c1_2", fill_palette = palette_oles_6),

 data_ola0 |>
  proc_plot_demo(c1_2, gse_recod) |>
  mutate(c1_2 = factor(c1_2,
                     levels = c("Muy en desacuerdo",
                                "En desacuerdo",
                                "Ni de acuerdo ni en desacuerdo",
                                "De acuerdo",
                                "Muy de Acuerdo",
                                "NS-NR"))) |>
  plot_propbar_gse(fill_column = "c1_2", fill_palette = palette_oles_6),

ncol = 2, nrow = 2, align = "hv", 
common.legend = TRUE
)|>
  annotate_figure(bottom=text_grob("Fuente: ESEP 2023, ola 0.",hjust = 1,x=1,size = 10))
```

```{r}
#| label: fig-c3_1-general
#| fig-cap: "Teniendo en cuenta su propia experiencia o lo que ha oído, ¿En qué medida se encuentra Ud. de acuerdo o en desacuerdo con que la Policía de Investigaciones de Chile (PDI) logra controlar el problema de la delincuencia en Chile?"
#| echo: false
#| warning: false

val_label(data_ola0$c3,99)<-"NS-NR"
val_label(data_ola0$c3,88)<-"NS-NR"

data_ola0 |>
  count(Variable=to_label(c3))|>
  mutate(prop=(n/nrow(data_ola0)*100)|>round(1),
         Item="La PDI logra controlar el problema de la delincuencia en Chile",
         Variable=factor(Variable,levels=c(
                               "Muy en desacuerdo",
                                "En desacuerdo",
                                "Ni de acuerdo ni en desacuerdo",
                                "De acuerdo",
                                "Muy de Acuerdo",
                                "NS-NR"))) |>
  
  ggplot(aes(x=Variable,y=prop,fill=Variable))+
  geom_bar(position="dodge", stat="identity",color="black") +
  theme_classic(base_size=20) +
  theme(legend.position="top",
        axis.title.x = element_blank(),
        axis.title.y = element_blank())+
  scale_y_continuous(labels = function(x) paste0(x, "%"),limits = c(0,100))+
  scale_x_discrete(labels = function(x) str_wrap(x, width = 13))+
  geom_text(aes(label=paste0(prop,"%"),vjust=-0.1),size=8) +
  scale_fill_manual(values = c("#440154","#440154","#440154",
                               "#440154","#440154","grey"))+
  guides(fill=FALSE)+
  labs(caption="Fuente: ESEP 2023, ola 0.")
```

```{r}
#| label: fig-c3-demo
#| fig-cap: "Teniendo en cuenta su propia experiencia o lo que ha oído, ¿En qué medida se encuentra Ud. de acuerdo o en desacuerdo con que la Policía de Investigaciones de Chile (PDI) logra controlar el problema de la delincuencia en Chile?"
#| echo: false
#| warning: false

ggarrange(

data_ola0 |> 
  proc_plot_demo(c3, sexo) |>
  mutate(c3 = factor(c3,
                     levels = c("Muy en desacuerdo",
                                "En desacuerdo",
                                "Ni de acuerdo ni en desacuerdo",
                                "De acuerdo",
                                "Muy de Acuerdo",
                                "NS-NR"))) |>
  plot_propbar_sexo(fill_column = "c3", fill_palette = palette_oles_6),


data_ola0 |> 
  proc_plot_demo(c3, edad_recod) |>
  mutate(c3 = factor(c3,
                     levels = c("Muy en desacuerdo",
                                "En desacuerdo",
                                "Ni de acuerdo ni en desacuerdo",
                                "De acuerdo",
                                "Muy de Acuerdo",
                                "NS-NR"))) |>
  plot_propbar_edad(fill_column = "c3", fill_palette = palette_oles_6),

data_ola0 |>
  proc_plot_demo(c3, zona) |>
  mutate(c3 = factor(c3,
                     levels = c("Muy en desacuerdo",
                                "En desacuerdo",
                                "Ni de acuerdo ni en desacuerdo",
                                "De acuerdo",
                                "Muy de Acuerdo",
                                "NS-NR"))) |> 
  plot_propbar_zona(fill_column = "c3", fill_palette = palette_oles_6),

 data_ola0 |>
  proc_plot_demo(c3, gse_recod) |>
  mutate(c3 = factor(c3,
                     levels = c("Muy en desacuerdo",
                                "En desacuerdo",
                                "Ni de acuerdo ni en desacuerdo",
                                "De acuerdo",
                                "Muy de Acuerdo",
                                "NS-NR"))) |>
  plot_propbar_gse(fill_column = "c3", fill_palette = palette_oles_6),

ncol = 2, nrow = 2, align = "hv", 
common.legend = TRUE
)|>
  annotate_figure(bottom=text_grob("Fuente: ESEP 2023, ola 0.",hjust = 1,x=1,size = 10))
```

# Legitimidad de las Policías
```{r}
#| label: fig-c-general2
#| fig-cap: "Teniendo en cuenta su propia experiencia o lo que ha oído, ¿en qué medida se encuentra Ud. de acuerdo o en desacuerdo con las siguientes afirmaciones sobre Carabineros de Chile?"
#| fig-subcap:
#|   - "En general, Los carabineros tienen la misma idea que yo sobre lo que está bien y lo que está mal"
#|   - "Hay que respetar las decisiones que toman los carabineros, aunque no se esté de acuerdo con ellas"
#| layout-ncol: 1
#| echo: false
#| warning: false
#| fig-height: 3.5

val_label(data_ola0$c1_3,99)<-"NS-NR"
val_label(data_ola0$c1_3,88)<-"NS-NR"

data_ola0 |>
  count(Variable=to_label(c1_3))|>
  mutate(prop=(n/nrow(data_ola0)*100)|>round(1),
         Item="En general, los carabineros tienen la misma idea que yo sobre lo que está bien y lo que está mal",
                  Variable=factor(Variable,levels=c(
                          "Muy en desacuerdo",
                          "En desacuerdo",
                          "Ni de acuerdo ni en desacuerdo",
                          "De acuerdo",
                          "Muy de Acuerdo",
                           "NS-NR"))) |>

  ggplot(aes(x=Variable,y=prop,fill=Variable))+
  geom_bar(position="dodge", stat="identity",color="black") +
  geom_text(aes(label=paste0(prop,"%")),
            vjust=-0.1,
            size=8) +
  theme_classic(base_size=20) +
  theme(
        axis.title.x = element_blank(),
        axis.title.y = element_blank())+
  scale_y_continuous(labels = function(x) paste0(x, "%"),limits = c(0,100))+
  scale_x_discrete(labels = function(x) str_wrap(x, width = 13))+
  scale_fill_manual(values = c("#440154","#440154","#440154",
                               "#440154","#440154","grey"))+
  guides(fill=FALSE)


data_ola0 <- data_ola0 %>%
  mutate(c1_4 = if_else(is.na(c1_4), 99, c1_4))

val_label(data_ola0$c1_4,99)<-"NS-NR"
val_label(data_ola0$c1_4,88)<-"NS-NR"

# Falta arreglar la introducción de NA
data_ola0 |>
  count(Variable=to_label(c1_4))|>
  group_by(Variable)|>
  summarise(n=sum(n))|>
  ungroup()|>
  mutate(prop=(n/nrow(data_ola0)*100)|>round(1),
         Item="Hay que respetar las decisiones que toman los carabineros, aunque no se esté de acuerdo con ellas",
                  Variable=factor(Variable,levels=c(
                          "Muy en desacuerdo",
                          "En desacuerdo",
                          "Ni de acuerdo ni en desacuerdo",
                          "De acuerdo",
                          "Muy de Acuerdo",
                           "NS-NR"))) |>

  ggplot(aes(x=Variable,y=prop,fill=Variable))+
  geom_bar(position="dodge", stat="identity",color="black") +
  geom_text(aes(label=paste0(prop,"%")),
            vjust=-0.1,
            size=8) +
  theme_classic(base_size=20) +
  theme(
        axis.title.x = element_blank(),
        axis.title.y = element_blank())+
  scale_y_continuous(labels = function(x) paste0(x, "%"),limits = c(0,100))+
  scale_x_discrete(labels = function(x) str_wrap(x, width = 13))+
  scale_fill_manual(values = c("#fde725","#fde725","#fde725",
                               "#fde725","#fde725","grey"))+
  guides(fill=FALSE)
```


```{r}
#| label: fig-c1_3-demo
#| fig-cap: "(Cruce demográfico) En general, Los carabineros tienen la misma idea que yo sobre lo que está bien y lo que está mal"
#| echo: false
#| warning: false

ggarrange(

data_ola0 |> 
  proc_plot_demo(c1_3, sexo) |>
  mutate(c1_3 = factor(c1_3,
                     levels = c("Muy en desacuerdo",
                                "En desacuerdo",
                                "Ni de acuerdo ni en desacuerdo",
                                "De acuerdo",
                                "Muy de Acuerdo",
                                "NS-NR"))) |>
  plot_propbar_sexo(fill_column = "c1_3", fill_palette = palette_oles_6),


data_ola0 |> 
  proc_plot_demo(c1_3, edad_recod) |>
  mutate(c1_3 = factor(c1_3,
                     levels = c("Muy en desacuerdo",
                                "En desacuerdo",
                                "Ni de acuerdo ni en desacuerdo",
                                "De acuerdo",
                                "Muy de Acuerdo",
                                "NS-NR"))) |>
  plot_propbar_edad(fill_column = "c1_3", fill_palette = palette_oles_6),

data_ola0 |>
  proc_plot_demo(c1_3, zona) |>
  mutate(c1_3 = factor(c1_3,
                     levels = c("Muy en desacuerdo",
                                "En desacuerdo",
                                "Ni de acuerdo ni en desacuerdo",
                                "De acuerdo",
                                "Muy de Acuerdo",
                                "NS-NR"))) |> 
  plot_propbar_zona(fill_column = "c1_3", fill_palette = palette_oles_6),

 data_ola0 |>
  proc_plot_demo(c1_3, gse_recod) |>
  mutate(c1_3 = factor(c1_3,
                     levels = c("Muy en desacuerdo",
                                "En desacuerdo",
                                "Ni de acuerdo ni en desacuerdo",
                                "De acuerdo",
                                "Muy de Acuerdo",
                                "NS-NR"))) |>
  plot_propbar_gse(fill_column = "c1_3", fill_palette = palette_oles_6),

ncol = 2, nrow = 2, align = "hv", 
common.legend = TRUE
)|>
  annotate_figure(bottom=text_grob("Fuente: ESEP 2023, ola 0.",hjust = 1,x=1,size = 10))
```

```{r}
#| label: fig-c1_4-demo
#| fig-cap: "(Cruce demográfico) Hay que respetar las decisiones que toman los carabineros, aunque no se esté de acuerdo con ellas"
#| echo: false
#| warning: false

ggarrange(

data_ola0 |> 
  proc_plot_demo(c1_4, sexo) |>
  mutate(c1_4 = factor(c1_4,
                     levels = c("Muy en desacuerdo",
                                "En desacuerdo",
                                "Ni de acuerdo ni en desacuerdo",
                                "De acuerdo",
                                "Muy de Acuerdo",
                                "NS-NR"))) |>
  plot_propbar_sexo(fill_column = "c1_4", fill_palette = palette_oles_6),


data_ola0 |> 
  proc_plot_demo(c1_4, edad_recod) |>
  mutate(c1_4 = factor(c1_4,
                     levels = c("Muy en desacuerdo",
                                "En desacuerdo",
                                "Ni de acuerdo ni en desacuerdo",
                                "De acuerdo",
                                "Muy de Acuerdo",
                                "NS-NR"))) |>
  plot_propbar_edad(fill_column = "c1_4", fill_palette = palette_oles_6),

data_ola0 |>
  proc_plot_demo(c1_4, zona) |>
  mutate(c1_4 = factor(c1_4,
                     levels = c("Muy en desacuerdo",
                                "En desacuerdo",
                                "Ni de acuerdo ni en desacuerdo",
                                "De acuerdo",
                                "Muy de Acuerdo",
                                "NS-NR"))) |> 
  plot_propbar_zona(fill_column = "c1_4", fill_palette = palette_oles_6),

 data_ola0 |>
  proc_plot_demo(c1_4, gse_recod) |>
  mutate(c1_4 = factor(c1_4,
                     levels = c("Muy en desacuerdo",
                                "En desacuerdo",
                                "Ni de acuerdo ni en desacuerdo",
                                "De acuerdo",
                                "Muy de Acuerdo",
                                "NS-NR"))) |>
  plot_propbar_gse(fill_column = "c1_4", fill_palette = palette_oles_6),

ncol = 2, nrow = 2, align = "hv", 
common.legend = TRUE
)|>
  annotate_figure(bottom=text_grob("Fuente: ESEP 2023, ola 0.",hjust = 1,x=1,size = 10))

```

# Justicia Procedimental de las Policías

```{r}
#| label: fig-c2-general
#| fig-cap: "Teniendo en cuenta su propia experiencia o lo que ha oído, ¿con qué frecuencia cree Ud. que los carabineros...?"
#| fig-subcap: 
#|   - "Toman decisiones justas e imparciales en los casos que se ocupa"
#|   - "Tratan a las personas con respeto en Chile"
#| layout-ncol: 1
#| echo: false
#| warning: false
#| fig-height: 4

val_label(data_ola0$c2_1,99)<-"NS-NR"
val_label(data_ola0$c2_1,88)<-"NS-NR"

val_label(data_ola0$c2_2,99)<-"NS-NR"
val_label(data_ola0$c2_2,88)<-"NS-NR"

data_ola0 |>
  count(Variable=to_label(c2_1))|>
  mutate(prop=(n/nrow(data_ola0)*100)|>round(1),
         Item="tratan a las personas con respeto en Chile")|>
  mutate(Variable=factor(Variable,levels=c(
    "Nunca",
    "Pocas veces",
    "Algunas veces",
    "Casi siempre",
    "Siempre",
    "NS-NR"
  )))|>

  ggplot(aes(x=Variable,y=prop,fill=Variable))+
  geom_bar(position="dodge", stat="identity",color="black") +
  mdthemes::md_theme_classic(base_size=20) +
  theme(legend.position="top",
        axis.title.x = element_blank(),
        axis.title.y = element_blank())+
  scale_y_continuous(labels = function(x) paste0(x, "%"),limits = c(0,100))+
  scale_x_discrete(labels = function(x) str_wrap(x, width = 8))+
  geom_text(aes(label=paste0(prop,"%"),vjust=-0.2),size=6) +
  scale_fill_manual(values=c("#440154","#440154","#440154",
                             "#440154","#440154","grey"))+
  guides(fill=FALSE)

data_ola0 |>
  count(Variable=to_label(c2_2)) |>
  mutate(prop=(n/nrow(data_ola0)*100)|>round(1),
         Item="Toman decisiones justas e imparciales en los casos que se ocupa?") |>
    mutate(Variable=factor(Variable,levels=c(
    "Nunca",
    "Pocas veces",
    "Algunas veces",
    "Casi siempre",
    "Siempre",
    "NS-NR"
  )))|>
  
  ggplot(aes(x=Variable,y=prop,fill=Variable))+
  geom_bar(position="dodge", stat="identity",color="black") +
  mdthemes::md_theme_classic(base_size=20) +
  theme(legend.position="top",
        axis.title.x = element_blank(),
        axis.title.y = element_blank())+
  scale_y_continuous(labels = function(x) paste0(x, "%"),limits = c(0,100))+
  geom_text(aes(label=paste0(prop,"%"),vjust=-0.2),size=6) +
  scale_fill_manual(values = c("#fde725","#fde725","#fde725",
                               "#fde725","#fde725","grey"))+
  scale_x_discrete(labels = function(x) str_wrap(x, width = 8))+
  guides(fill=FALSE)
```

```{r}
#| label: fig-c2_1-demo
#| fig-cap: "(Cruce demográfico) Los carabineros toman decisiones justas e imparciales en los casos que se ocupa"
#| echo: false
#| warning: false

ggarrange(

data_ola0 |> 
  proc_plot_demo(c2_1, sexo) |>
  mutate(c2_1 = factor(c2_1,
                     levels = c(
    "Nunca",
    "Pocas veces",
    "Algunas veces",
    "Casi siempre",
    "Siempre",
    "NS-NR"))) |>
  plot_propbar_sexo(fill_column = "c2_1", fill_palette = palette_oles_6),


data_ola0 |> 
  proc_plot_demo(c2_1, edad_recod) |>
  mutate(c2_1 = factor(c2_1,
                     levels = c(
    "Nunca",
    "Pocas veces",
    "Algunas veces",
    "Casi siempre",
    "Siempre",
    "NS-NR"
                     ))) |>
  plot_propbar_edad(fill_column = "c2_1", fill_palette = palette_oles_6),

data_ola0 |>
  proc_plot_demo(c2_1, zona) |>
  mutate(c2_1 = factor(c2_1,
                     levels = c("Nunca",
    "Pocas veces",
    "Algunas veces",
    "Casi siempre",
    "Siempre",
    "NS-NR"))) |> 
  plot_propbar_zona(fill_column = "c2_1", fill_palette = palette_oles_6),

 data_ola0 |>
  proc_plot_demo(c2_1, gse_recod) |>
  mutate(c2_1 = factor(c2_1,
                     levels = c("Nunca",
    "Pocas veces",
    "Algunas veces",
    "Casi siempre",
    "Siempre",
    "NS-NR"))) |>
  plot_propbar_gse(fill_column = "c2_1", fill_palette = palette_oles_6),

ncol = 2, nrow = 2, align = "hv", 
common.legend = TRUE
)|>
  annotate_figure(bottom=text_grob("Fuente: ESEP 2023, ola 0.",hjust = 1,x=1,size = 10))
```

```{r}
#| label: fig-c2_2-demo
#| fig-cap: "(Cruce demográfico) Los carabineros tratan a las personas con respeto en los casos que se ocupa"
#| echo: false
#| warning: false

ggarrange(

data_ola0 |> 
  proc_plot_demo(c2_2, sexo) |>
  mutate(c2_2 = factor(c2_2,
                     levels = c(
    "Nunca",
    "Pocas veces",
    "Algunas veces",
    "Casi siempre",
    "Siempre",
    "NS-NR"))) |>
  plot_propbar_sexo(fill_column = "c2_2", fill_palette = palette_oles_6),


data_ola0 |> 
  proc_plot_demo(c2_2, edad_recod) |>
  mutate(c2_2 = factor(c2_2,
                     levels = c(
    "Nunca",
    "Pocas veces",
    "Algunas veces",
    "Casi siempre",
    "Siempre",
    "NS-NR"
                     ))) |>
  plot_propbar_edad(fill_column = "c2_2", fill_palette = palette_oles_6),

data_ola0 |>
  proc_plot_demo(c2_2, zona) |>
  mutate(c2_2 = factor(c2_2,
                     levels = c("Nunca",
    "Pocas veces",
    "Algunas veces",
    "Casi siempre",
    "Siempre",
    "NS-NR"))) |> 
  plot_propbar_zona(fill_column = "c2_2", fill_palette = palette_oles_6),

 data_ola0 |>
  proc_plot_demo(c2_2, gse_recod) |>
  mutate(c2_2 = factor(c2_2,
                     levels = c("Nunca",
    "Pocas veces",
    "Algunas veces",
    "Casi siempre",
    "Siempre",
    "NS-NR"))) |>
  plot_propbar_gse(fill_column = "c2_2", fill_palette = palette_oles_6),

ncol = 2, nrow = 2, align = "hv", 
common.legend = TRUE
)|>
  annotate_figure(bottom=text_grob("Fuente: ESEP 2023, ola 0.",hjust = 1,x=1,size = 10))
```


```{r}
#| label: fig-c4-general
#| fig-cap: "Teniendo en cuenta su propia experiencia o lo que ha oído, ¿con qué frecuencia cree Ud. que los funcionarios de la PDI...?"
#| fig-subcap: 
#|   - "Toman decisiones justas e imparciales en los casos que se ocupa"
#|   - "Tratan a las personas con respeto en Chile"
#| layout-ncol: 1
#| echo: false
#| warning: false
#| fig-height: 5

val_label(data_ola0$c4_1,99)<-"NS-NR"
val_label(data_ola0$c4_1,88)<-"NS-NR"
val_label(data_ola0$c4_2,99)<-"NS-NR"
val_label(data_ola0$c4_2,88)<-"NS-NR"

data_ola0 |>
  count(Variable=to_label(c4_1))|>
  mutate(prop=(n/nrow(data_ola0)*100)|>round(1))|>
  
  ggplot(aes(x=Variable,y=prop,fill=Variable))+
  geom_bar(position="dodge", stat="identity",color="black") +
  mdthemes::md_theme_classic(base_size=20) +
  theme(legend.position="top",
        axis.title.x = element_blank(),
        axis.title.y = element_blank())+
  scale_y_continuous(labels = function(x) paste0(x, "%"),limits = c(0,100))+
  geom_text(aes(label=paste0(prop,"%"),vjust=-0.2),size=6) +
  scale_fill_manual(values = c("#440154","#440154","#440154",
                               "#440154","#440154","grey"))+
  guides(fill=FALSE)+
  labs(caption="Fuente: ESEP 2023, Ola 0.")

data_ola0 |>
  count(Variable=to_label(c4_2)) |>
  mutate(prop=(n/nrow(data_ola0)*100)|>round(1),
         Item="Toman decisiones justas e imparciales en los casos que se ocupa?") |>
  
  ggplot(aes(x=Variable,y=prop,fill=Variable))+
  geom_bar(position="dodge", stat="identity",color="black") +
  mdthemes::md_theme_classic(base_size=20) +
  theme(legend.position="top",
        axis.title.x = element_blank(),
        axis.title.y = element_blank())+
  scale_y_continuous(labels = function(x) paste0(x, "%"),limits = c(0,100))+
  geom_text(aes(label=paste0(prop,"%"),vjust=-0.2),size=6)+
  scale_fill_manual(values = c("#fde725","#fde725","#fde725",
                               "#fde725","#fde725","grey"))+
  guides(fill=FALSE)+
  labs(caption="Fuente: ESEP 2023, Ola 0.")
```

```{r}
#| label: fig-c4_1-demo
#| fig-cap: "(Cruce demográfico) Los funcionarios de la PDI toman decisiones justas e imparciales en los casos que se ocupa"
#| echo: false
#| warning: false

ggarrange(

data_ola0 |> 
  proc_plot_demo(c4_1, sexo) |>
  mutate(c4_1 = factor(c4_1,
                     levels = c(
    "Nunca",
    "Pocas veces",
    "Algunas veces",
    "Casi siempre",
    "Siempre",
    "NS-NR"))) |>
  plot_propbar_sexo(fill_column = "c4_1", fill_palette = palette_oles_6),


data_ola0 |> 
  proc_plot_demo(c4_1, edad_recod) |>
  mutate(c4_1 = factor(c4_1,
                     levels = c(
    "Nunca",
    "Pocas veces",
    "Algunas veces",
    "Casi siempre",
    "Siempre",
    "NS-NR"
                     ))) |>
  plot_propbar_edad(fill_column = "c4_1", fill_palette = palette_oles_6),

data_ola0 |>
  proc_plot_demo(c4_1, zona) |>
  mutate(c4_1 = factor(c4_1,
                     levels = c("Nunca",
    "Pocas veces",
    "Algunas veces",
    "Casi siempre",
    "Siempre",
    "NS-NR"))) |> 
  plot_propbar_zona(fill_column = "c4_1", fill_palette = palette_oles_6),

 data_ola0 |>
  proc_plot_demo(c4_1, gse_recod) |>
  mutate(c4_1 = factor(c4_1,
                     levels = c("Nunca",
    "Pocas veces",
    "Algunas veces",
    "Casi siempre",
    "Siempre",
    "NS-NR"))) |>
  plot_propbar_gse(fill_column = "c4_1", fill_palette = palette_oles_6),

ncol = 2, nrow = 2, align = "hv", 
common.legend = TRUE
)|>
  annotate_figure(bottom=text_grob("Fuente: ESEP 2023, ola 0.",hjust = 1,x=1,size = 10))
```

```{r}
#| label: fig-c4_2-demo
#| fig-cap: "(Cruce demográfico) Los funcionarios de la PDI tratan a las personas con respeto en los casos que se ocupa"
#| echo: false
#| warning: false

ggarrange(

data_ola0 |> 
  proc_plot_demo(c4_2, sexo) |>
  mutate(c4_2 = factor(c4_2,
                     levels = c(
    "Nunca",
    "Pocas veces",
    "Algunas veces",
    "Casi siempre",
    "Siempre",
    "NS-NR"))) |>
  plot_propbar_sexo(fill_column = "c4_2", fill_palette = palette_oles_6),


data_ola0 |> 
  proc_plot_demo(c4_2, edad_recod) |>
  mutate(c4_2 = factor(c4_2,
                     levels = c(
    "Nunca",
    "Pocas veces",
    "Algunas veces",
    "Casi siempre",
    "Siempre",
    "NS-NR"
                     ))) |>
  plot_propbar_edad(fill_column = "c4_2", fill_palette = palette_oles_6),

data_ola0 |>
  proc_plot_demo(c4_2, zona) |>
  mutate(c4_2 = factor(c4_2,
                     levels = c("Nunca",
    "Pocas veces",
    "Algunas veces",
    "Casi siempre",
    "Siempre",
    "NS-NR"))) |> 
  plot_propbar_zona(fill_column = "c4_2", fill_palette = palette_oles_6),

 data_ola0 |>
  proc_plot_demo(c4_2, gse_recod) |>
  mutate(c4_2 = factor(c4_2,
                     levels = c("Nunca",
    "Pocas veces",
    "Algunas veces",
    "Casi siempre",
    "Siempre",
    "NS-NR"))) |>
  plot_propbar_gse(fill_column = "c4_2", fill_palette = palette_oles_6),

ncol = 2, nrow = 2, align = "hv", 
common.legend = TRUE
)|>
  annotate_figure(bottom=text_grob("Fuente: ESEP 2023, ola 0.",hjust = 1,x=1,size = 10))
```

# Confianza en las Policías

```{r}
#| label: fig-c5-general
#| fig-cap: "¿Podría Ud. decirme cuánta confianza tiene cada una de estas instituciones?"
#| echo: false
#| warning: false

val_label(data_ola0$c5_1,99)<-"NS-NR"
val_label(data_ola0$c5_1,88)<-"NS-NR"
val_label(data_ola0$c5_2,99)<-"NS-NR"
val_label(data_ola0$c5_2,88)<-"NS-NR"

rbind(
data_ola0 |>
  count(Variable=to_label(c5_1)) |>
  mutate(prop=(n/nrow(data_ola0)*100),
         Item="Carabineros de Chile",
         prop=round(prop,1)),
data_ola0 |>
  count(Variable=to_label(c5_2)) |>
  mutate(prop=(n/nrow(data_ola0)*100),
         Item="Policía de Investigaciones",
         prop=round(prop,1))
) |>
  
  ggplot(aes(x=Variable,y=prop,fill=Item))+
  geom_bar(position="dodge", stat="identity",color="black") +
  mdthemes::md_theme_classic(base_size=20) +
  theme(legend.position="top",
        axis.title.x = element_blank(),
        axis.title.y = element_blank())+
  scale_y_continuous(labels = function(x) paste0(x, "%"))+
  scale_fill_manual(values = palette_oles_2)+
  scale_y_continuous(labels = function(x) paste0(x, "%"),limits = c(0,100))+
  geom_text(aes(label=paste0(prop,"%"),vjust=-0.2),position = position_dodge(1),vjust=0.5,hjust=-0.1,size=7) +
  coord_flip()+
  labs(fill="",
       caption="Fuente: ESEP 2023, Ola 0")+
  guides(fill = guide_legend(reverse = TRUE))
```

```{r}
#| label: fig-c5_1-general
#| fig-cap: "¿Podría Ud. decirme cuánta confianza tiene en Carabineros de Chile? (Cruce demográfico)"
#| echo: false
#| warning: false

ggarrange(

data_ola0 |> 
  proc_plot_demo(c5_1, sexo) |>
  plot_propbar_sexo(fill_column = "c5_1", fill_palette = palette_oles_5),


data_ola0 |> 
  proc_plot_demo(c5_1, edad_recod) |>
  plot_propbar_edad(fill_column = "c5_1", fill_palette = palette_oles_5),

data_ola0 |>
  proc_plot_demo(c5_1, zona) |>
  plot_propbar_zona(fill_column = "c5_1", fill_palette = palette_oles_5),

 data_ola0 |>
  proc_plot_demo(c5_1, gse_recod) |>
  plot_propbar_gse(fill_column = "c5_1", fill_palette = palette_oles_5),

ncol = 2, nrow = 2, align = "hv", 
common.legend = TRUE
)|>
  annotate_figure(bottom=text_grob("Fuente: ESEP 2023, ola 0.",hjust = 1,x=1,size = 10))
```
```{r}
#| label: fig-c5_2-general
#| fig-cap: "¿Podría Ud. decirme cuánta confianza tiene en la Policiía de Investigaciones (PDI)? (Cruce demográfico)"

ggarrange(

data_ola0 |> 
  proc_plot_demo(c5_2, sexo) |>
  plot_propbar_sexo(fill_column = "c5_2", fill_palette = palette_oles_5),


data_ola0 |> 
  proc_plot_demo(c5_2, edad_recod) |>
  plot_propbar_edad(fill_column = "c5_2", fill_palette = palette_oles_5),

data_ola0 |>
  proc_plot_demo(c5_2, zona) |>
  plot_propbar_zona(fill_column = "c5_2", fill_palette = palette_oles_5),

 data_ola0 |>
  proc_plot_demo(c5_2, gse_recod) |>
  plot_propbar_gse(fill_column = "c5_2", fill_palette = palette_oles_5),

ncol = 2, nrow = 2, align = "hv", 
common.legend = TRUE
)|>
  annotate_figure(bottom=text_grob("Fuente: ESEP 2023, ola 0.",hjust = 1,x=1,size = 10))
```

# Empoderamiento de las policías

```{r}
#| label: fig-c7-general
#| fig-cap: "¿Qué tan de acuerdo o en desacuerdo se encuentra usted con las siguientes medidas?"
#| fig-subcap:
#|   - "Endurecer las penas contra quienes atenten contra la integridad física de Carabineros, PDI y Gendarmería"
#|   - "Dar mayores facilidades para que los carabineros puedan usar su arma de servicio cuando lo estimen necesario "
#| layout-ncol: 1
#| fig-height: 3.5

val_label(data_ola0$c7_1,99)<-"NS-NR"
val_label(data_ola0$c7_1,88)<-"NS-NR"
val_label(data_ola0$c7_2,99)<-"NS-NR"
val_label(data_ola0$c7_2,88)<-"NS-NR"

data_ola0 |>
  count(Variable=to_label(c7_1)) |>
  mutate(prop=(n/nrow(data_ola0)*100),
                  Variable=factor(Variable,levels=c(
                          "Muy en desacuerdo",
                          "En desacuerdo",
                          "Ni de acuerdo ni en desacuerdo",
                          "De acuerdo",
                          "Muy de Acuerdo",
                           "NS-NR")),
         prop=round(prop,1)) |>
  
  ggplot(aes(x=Variable,y=prop,fill=Variable))+
  geom_bar(position="dodge", stat="identity",color="black") +
  theme_classic(base_size=20) +
  theme(legend.position="top",
        axis.title.x = element_blank(),
        axis.title.y = element_blank())+
  scale_y_continuous(labels = function(x) paste0(x, "%"),limits = c(0,100))+
  scale_x_discrete(labels = function(x) str_wrap(x, width = 10)) +
  scale_fill_manual(values = c("#440154","#440154","#440154",
                               "#440154","#440154","grey"))+
  geom_text(aes(label=paste0(prop,"%"),vjust=-0.2),size=7) +
  guides(fill=FALSE)+
  labs(caption="Fuente: ESEP 2023, Ola 0")

data_ola0 |>
  count(Variable=to_label(c7_2)) |>
  mutate(prop=(n/nrow(data_ola0)*100),
                  Variable=factor(Variable,levels=c(
                          "Muy en desacuerdo",
                          "En desacuerdo",
                          "Ni de acuerdo ni en desacuerdo",
                          "De acuerdo",
                          "Muy de Acuerdo",
                           "NS-NR")),
         prop=round(prop,1))|>
  
  ggplot(aes(x=Variable,y=prop,fill=Variable))+
  geom_bar(position="dodge", stat="identity",color="black") +
  theme_classic(base_size=20) +
  theme(legend.position="top",
        axis.title.x = element_blank(),
        axis.title.y = element_blank())+
  scale_y_continuous(labels = function(x) paste0(x, "%"),limits = c(0,100))+
  scale_x_discrete(labels = function(x) str_wrap(x, width = 10)) +
  scale_fill_manual(values=c("#fde725","#fde725","#fde725",
                             "#fde725","#fde725","grey"))+
  geom_text(aes(label=paste0(prop,"%"),vjust=-0.2),size=7) +
  guides(fill=FALSE)+
  labs(caption="Fuente: ESEP 2023, Ola 0")
```

```{r}
#| label: fig-c7_1-demo
#| fig-cap: "(Cruce demográfico) Endurecer las penas contra quienes atenten contra la integridad física de Carabineros, PDI y Gendarmería"

ggarrange(

data_ola0 |> 
  proc_plot_demo(c7_1, sexo) |>
  mutate(c7_1 = factor(c7_1,
                     levels = c("Muy en desacuerdo",
                                "En desacuerdo",
                                "Ni de acuerdo ni en desacuerdo",
                                "De acuerdo",
                                "Muy de Acuerdo",
                                "NS-NR"))) |>
  plot_propbar_sexo(fill_column = "c7_1", fill_palette = palette_oles_6),


data_ola0 |> 
  proc_plot_demo(c7_1, edad_recod) |>
  mutate(c7_1 = factor(c7_1,
                     levels = c("Muy en desacuerdo",
                                "En desacuerdo",
                                "Ni de acuerdo ni en desacuerdo",
                                "De acuerdo",
                                "Muy de Acuerdo",
                                "NS-NR"))) |>
  plot_propbar_edad(fill_column = "c7_1", fill_palette = palette_oles_6),

data_ola0 |>
  proc_plot_demo(c7_1, zona) |>
  mutate(c7_1 = factor(c7_1,
                     levels = c("Muy en desacuerdo",
                                "En desacuerdo",
                                "Ni de acuerdo ni en desacuerdo",
                                "De acuerdo",
                                "Muy de Acuerdo",
                                "NS-NR"))) |> 
  plot_propbar_zona(fill_column = "c7_1", fill_palette = palette_oles_6),

 data_ola0 |>
  proc_plot_demo(c7_1, gse_recod) |>
  mutate(c7_1 = factor(c7_1,
                     levels = c("Muy en desacuerdo",
                                "En desacuerdo",
                                "Ni de acuerdo ni en desacuerdo",
                                "De acuerdo",
                                "Muy de Acuerdo",
                                "NS-NR"))) |>
  plot_propbar_gse(fill_column = "c7_1", fill_palette = palette_oles_6),

ncol = 2, nrow = 2, align = "hv", 
common.legend = TRUE
)|>
  annotate_figure(bottom=text_grob("Fuente: ESEP 2023, ola 0.",hjust = 1,x=1,size = 10))


```

```{r}
#| label: fig-c7_2-demo
#| fig-cap: "(Cruce demográfico) Dar mayores facilidades para que los carabineros puedan usar su arma de servicio cuando lo estimen necesario"

ggarrange(

data_ola0 |> 
  proc_plot_demo(c7_2, sexo) |>
  mutate(c7_2 = factor(c7_2,
                     levels = c("Muy en desacuerdo",
                                "En desacuerdo",
                                "Ni de acuerdo ni en desacuerdo",
                                "De acuerdo",
                                "Muy de Acuerdo",
                                "NS-NR"))) |>
  plot_propbar_sexo(fill_column = "c7_2", fill_palette = palette_oles_6),


data_ola0 |> 
  proc_plot_demo(c7_2, edad_recod) |>
  mutate(c7_2 = factor(c7_2,
                     levels = c("Muy en desacuerdo",
                                "En desacuerdo",
                                "Ni de acuerdo ni en desacuerdo",
                                "De acuerdo",
                                "Muy de Acuerdo",
                                "NS-NR"))) |>
  plot_propbar_edad(fill_column = "c7_2", fill_palette = palette_oles_6),

data_ola0 |>
  proc_plot_demo(c7_2, zona) |>
  mutate(c7_2 = factor(c7_2,
                     levels = c("Muy en desacuerdo",
                                "En desacuerdo",
                                "Ni de acuerdo ni en desacuerdo",
                                "De acuerdo",
                                "Muy de Acuerdo",
                                "NS-NR"))) |> 
  plot_propbar_zona(fill_column = "c7_2", fill_palette = palette_oles_6),

 data_ola0 |>
  proc_plot_demo(c7_2, gse_recod) |>
  mutate(c7_2 = factor(c7_2,
                     levels = c("Muy en desacuerdo",
                                "En desacuerdo",
                                "Ni de acuerdo ni en desacuerdo",
                                "De acuerdo",
                                "Muy de Acuerdo",
                                "NS-NR"))) |>
  plot_propbar_gse(fill_column = "c7_2", fill_palette = palette_oles_6),

ncol = 2, nrow = 2, align = "hv", 
common.legend = TRUE
)|>
  annotate_figure(bottom=text_grob("Fuente: ESEP 2023, ola 0.",hjust = 1,x=1,size = 10))


```

# Ficha Técnica

```{r}
readxl::read_xlsx(path = file.path('../data/ficha_tecnica_w0.xlsx'), 
                         sheet = 'w0') |>
  
  kbl(booktabs = TRUE) |>
    kable_styling(latex_options = c("repeat_header","hold_position"),
                bootstrap_options = "bordered",full_width = T) |>
  kable_classic_2()
```