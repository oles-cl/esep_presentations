---
title: "Estudio de Percepciones de Seguridad y Policias en Chile 2023-2025"
subtitle: "Reporte de resultados Ola 0"
author: "Observatorio de Violencia y Legitimidad Social"
date: 03-05-2024
format: 
  revealjs:
    logo: img/oles_logo.png
    multiplex: true
    theme: ["pp.scss"]
    footer: "[Visita nuestro sitio web www.oles.cl](https://oles2.netlify.app/)"
    slide-number: c/t
css: portrait.css
editor: visual
---

```{r setup}
pacman::p_load(tidyverse,
               ggplot2,
               knitr,
               kableExtra,
               haven,
               labelled,
               sjlabelled,
               ggrepel,
               mdthemes,
               readxl,
               stringr,
               wrapr,
               scales,
               janitor,
               ggpubr,
               forcats,
               gt,
               stringr,
               viridis
               )

options(digits=1)

level_likert_1 <- c(
  "Muy en desacuerdo",
  "En desacuerdo",
  "Ni de acuerdo ni en desacuerdo",
  "De acuerdo",         
  "Muy de acuerdo",
  "NS-NR")

palette_likert_5 <- c(
  "#fde725",
  "#5ec962",
  "#3b528b",
  "#440154",
  "grey"
)

palette_oles_5 <- palette_likert_5

palette_oles_6 <- c(
  "#fde725",
  "#7ad151",
  "#2a788e",
  "#414487",
  "#440154",
  "grey"
  )

palette_likert_4 <-c(
  "#fde725",
  "#35b779",
  "#31688e",
  "#440154"
)

palette_oles_4 <-c(
  "#fde725",
  "#2a788e",
  "#440154",
  "grey"
)

palette_oles_3 <- c(
  "#fde725",
  "#440154",
  "grey"
)

palette_oles_2 <- c(
  "#fde725",
  "#440154"
)


# función demográficas sexo
plot_propbar_sexo <- function(x, fill_column, fill_palette) {
  x |>
  ggplot(aes(x = sexo, y = n, fill = !!as.name(fill_column))) +
    geom_bar(position = "fill", stat = "identity", color = "black", width = 0.6) +
    geom_text(aes(label = label), position = position_fill(vjust = 0.5), size = 4.5, color = "black") + # Aumenta el tamaño del texto
    coord_flip() +
    theme_classic() +
    theme(legend.position = "top",
          axis.title.x = element_blank(),
          axis.title.y = element_blank(),
          axis.text.x = element_text(size = 15),  # Aumenta el tamaño del eje X
          axis.text.y = element_text(size = 15),  # Aumenta el tamaño del eje Y
          legend.text = element_text(size = 12),  # Aumenta el tamaño de la leyenda de color
          legend.title = element_text(size = 1)) +  # No ver
    labs(fill = "") +
    scale_fill_manual(values = fill_palette) +
    scale_y_continuous(labels = function(x) paste0(x * 100, "%")) +
    guides(fill = guide_legend(reverse = TRUE))
}

# función demográficas edad
plot_propbar_edad <- function(x, fill_column, fill_palette) {
  x |>
  ggplot(aes(x = edad_recod, y = n, fill = !!as.name(fill_column))) +
    geom_bar(position = "fill", stat = "identity", color = "black", width = 0.6) +
    geom_text(aes(label = label), position = position_fill(vjust = 0.5), size = 4.5, color = "black") + # Aumenta el tamaño del texto
    coord_flip() +
    theme_classic() +
    theme(legend.position = "top",
          axis.title.x = element_blank(),
          axis.title.y = element_blank(),
          axis.text.x = element_text(size = 15),  # Aumenta el tamaño del eje X
          axis.text.y = element_text(size = 15),  # Aumenta el tamaño del eje Y
          legend.text = element_text(size = 12),  # Aumenta el tamaño de la leyenda de color
          legend.title = element_text(size = 1)) +  # No ver
    labs(fill = "") +
    scale_fill_manual(values = fill_palette) +
    scale_y_continuous(labels = function(x) paste0(x * 100, "%")) +
    guides(fill = guide_legend(reverse = TRUE))
}

# función propbar zona
plot_propbar_zona <- function(x, fill_column, fill_palette) {
  x |>
  ggplot(aes(x = zona, y = n, fill = !!as.name(fill_column))) +
    geom_bar(position = "fill", stat = "identity", color = "black", width = 0.6) +
    geom_text(aes(label = label), position = position_fill(vjust = 0.5), size = 4.5, color = "black") + # Aumenta el tamaño del texto
    coord_flip() +
    theme_classic() +
    theme(legend.position = "top",
          axis.title.x = element_blank(),
          axis.title.y = element_blank(),
          axis.text.x = element_text(size = 15),  # Aumenta el tamaño del eje X
          axis.text.y = element_text(size = 15),  # Aumenta el tamaño del eje Y
          legend.text = element_text(size = 12),  # Aumenta el tamaño de la leyenda de color
          legend.title = element_text(size = 1)) +  # Aumenta el tamaño del título de la leyenda
    labs(fill = "") +
    scale_fill_manual(values = fill_palette) +
    scale_y_continuous(labels = function(x) paste0(x * 100, "%")) +
    guides(fill = guide_legend(reverse = TRUE))
}

# función propbar gse
plot_propbar_gse <- function(x, fill_column, fill_palette) {
  x |>
  ggplot(aes(x = gse_recod, y = n, fill = !!as.name(fill_column))) +
    geom_bar(position = "fill", stat = "identity", color = "black", width = 0.6) +
    geom_text(aes(label = label), position = position_fill(vjust = 0.5), size = 4.5, color = "black") + # Aumenta el tamaño del texto
    coord_flip() +
    theme_classic() +
    theme(legend.position = "top",
          axis.title.x = element_blank(),
          axis.title.y = element_blank(),
          axis.text.x = element_text(size = 15),  # Aumenta el tamaño del eje X
          axis.text.y = element_text(size = 15),  # Aumenta el tamaño del eje Y
          legend.text = element_text(size = 12),  # Aumenta el tamaño de la leyenda de color
          legend.title = element_text(size = 1)) +  # No ver
    labs(fill = "") +
    scale_fill_manual(values = fill_palette) +
    scale_y_continuous(labels = function(x) paste0(x * 100, "%")) +
    guides(fill = guide_legend(reverse = TRUE))
}



#función base descriptivos
proc_plot_demo <- function(x, variable, demografico) {
  x %>%
    mutate({{ variable }} := to_label({{ variable }})) %>%
    drop_na({{ demografico }}) %>%
    group_by({{ demografico }}) %>%
    count({{ variable }}) %>%
    mutate(prop = round(n / sum(n) * 100, 0),
           ola = "Ola 0 (Septiembre-Noviembre 2023)",
           label=ifelse(prop>4,paste0(prop,"%"),NA))
}

data_ola0 <- readRDS("../data/esep_w0.rds") |>
  janitor::clean_names()|>
   rename(
         edad=edad_encuestado
         )|>
   mutate(edad_recod=case_when(edad <= 34 ~ "18 y 34 años",
                              edad > 34 & edad <= 54 ~ "35 y 54 años",
                              edad > 54 ~ "55 años o más"),
          region=paste0(toupper(substr(region, 1, 1)),tolower(substr(region, 2, nchar(region)))),
          zona=case_when(
            region%in%c("Arica y parinacota","Tarapacá","Antofagasta")~"Norte Grande",
            region%in%c("Coquimbo","Atacama")~"Norte Chico",
            region=="Metropolitana"~"Región Metropolitina",
            region%in%c("Valparaíso","Libertador Bernardo O’Higgins",
                        "Maule","Ñuble")~"Zona Central",
            region%in%c("Biobío","Araucanía","Los lagos","Los ríos")~"Zona Sur",
            region%in%c("Aysén","Magallanes")~"Zona Austral"
          ),
          zona=factor(zona,levels = c("Norte Grande",
                                      "Norte Chico",
                                      "Región Metropolitina",
                                      "Zona Central",
                                      "Zona Sur",
                                      "Zona Austral")),
          gse_recod=case_when(
            gse%in%c(6,5)~"E/D",
            gse%in%c(4,3)~"C2/C3",
            gse%in%c(2,1)~"ABC1",
            gse==7~NA_character_
          ),
          sexo=to_label(sexo),
          fecha=as.Date(fecha, format = "%Y/%m/%d"),
          month=format(fecha, "%B"),
          date_recod=case_when(
            month%in%c("May","June")~"Mayo-Junio 2023",
            month%in%c("July","August")~"Julio-Agosto 2023",
            month%in%c("September","October")~"Sept-Oct 2023",
            month%in%c("November","December")~"Nov-Dic 2023",
            month%in%c("January","February","March")~"Enero-Febrero 2024"
          ),
          date_recod=factor(date_recod,levels=c(
            "Mayo-Junio 2023",
            "Julio-Agosto 2023",
            "Sept-Oct 2023",
            "Nov-Dic 2023",
            "Enero-Febrero 2024"
          )
         )
        ) 
```

## Qué es OLES?

::: columns
::: column
OLES agrupa investigadores/as de diferentes disciplinas y universidades en Chile con el objetivo de contribuir a la comprensión de los mecanismos de legitimidad policial y justificación de la violencia mediante el desarrollo de investigaciones bajo criterios de Ciencia Abierta y en diálogo con actores sociales.
:::

::: column
::: {layout-ncol="2"}
##### Alianzas OLES

![](img/logos.png)
:::
:::
:::


------------------------------------------------------------------------

### Legitimidad Social

#### ¿Qué es y por qué importa?

::: columns
::: column
-   Creencia en el derecho de las policías de ejercer su poder y dictar el comportamiento apropiado (Tyler & Jackson, 2013; Jackson, 2018)
:::

::: column
-   Percepción de coincidencia entre los valores de la ciudadanía y los valores de las policías
-   Creencia de que existe la obligación de obedecer a las policías
:::
:::

------------------------------------------------------------------------

### Legitimidad Social

#### ¿Cómo lograr legitimidad social?

<center>![](img/jp_legitimidad.png){width="70%"}</center>

------------------------------------------------------------------------

### ¿Qué es la Justicia Procedimental?

::: columns
::: column
-   Percepción de que las autoridades operan según procedimientos neutros y tratan a la ciudadanía de manera justa y respetuosa (Tyler & Blader, 2000)
:::

::: column
-   Foco en las interacciones entre las policías y la ciudadanía
:::
:::

------------------------------------------------------------------------

### ¿Qué es la Justicia Procedimental?

<center>![](img/jp.png){width="50%"}</center>

------------------------------------------------------------------------

## Ficha técnica del Estudio {.smaller}

```{r}
readxl::read_xlsx(path = file.path('../data/ficha_tecnica_w0.xlsx'), 
                         sheet = 'w0') |>
  
  kbl(booktabs = TRUE) |>
    kable_styling(latex_options = c("repeat_header","hold_position"),
                bootstrap_options = "bordered",full_width = T,
                font_size=18) |>
  kable_classic_2()
```

# Percepción de seguridad {.r-fit-text background-image="img/oles_delincuencia.jpg"}

------------------------------------------------------------------------

#### Pensando en la delincuencia, usted diría que durante los últimos 12 meses la delincuencia en el país...

```{r}
val_label(data_ola0$b1,99)<-"NS-NR"
val_label(data_ola0$b1,88)<-"NS-NR"

data_ola0 |>
    mutate(b1=to_label(b1))|>
  count(b1) |>
  mutate(prop=(n/sum(n)*100)|>round(1))|>

  ggplot(aes(x=b1,y=prop,fill=b1))+
  geom_bar(position="dodge", stat="identity",color="black") +
  geom_text(aes(label=paste0(prop,"%")),
            vjust=-0.1,
            size=8) +
  theme_classic(base_size=20) +
  theme(axis.title.x = element_blank(),
        axis.title.y = element_blank())+
  scale_y_continuous(labels = function(x) paste0(x, "%"),limits = c(0,100))+
  scale_x_discrete(labels = function(x) str_wrap(x, width = 13))+
  scale_fill_manual(values = c("#440154","#440154","#440154",
                               "grey"))+
  guides(fill=FALSE)
```

------------------------------------------------------------------------

#### Pensando en la delincuencia, usted diría que durante los últimos 12 meses la delincuencia en el país...

```{r}
ggarrange(

data_ola0 |> 
  proc_plot_demo(b1,sexo)|>
  mutate(b1=factor(b1,
                   levels=c("Disminuyó",
                            "Se mantuvo",
                            "Aumentó",
                            "NS-NR"))) |>
  plot_propbar_sexo(fill_column="b1",fill_palette=palette_oles_4),


data_ola0 |> 
  proc_plot_demo(b1,edad_recod)|>
  mutate(b1=factor(b1,
                   levels=c("Disminuyó",
                            "Se mantuvo",
                            "Aumentó",
                            "NS-NR"))) |>
  plot_propbar_edad(fill_column = "b1",fill_palette = palette_oles_4),

data_ola0 |>
  proc_plot_demo(b1,zona)|>
  mutate(b1=factor(b1,
                   levels=c("Disminuyó",
                            "Se mantuvo",
                            "Aumentó",
                            "NS-NR"))) |> 
  plot_propbar_zona(fill_column = "b1",fill_palette = palette_oles_4),

 data_ola0 |>
  proc_plot_demo(b1,gse_recod)|>
  mutate(b1=factor(b1,
                   levels=c("Disminuyó",
                            "Se mantuvo",
                            "Aumentó",
                            "NS-NR"))) |>
  plot_propbar_gse(fill_column = "b1",fill_palette = palette_oles_4),

ncol = 2, nrow = 2, align = "hv", 
          common.legend = TRUE
 
)|>
  annotate_figure(bottom=text_grob("Fuente: ESEP 2023, ola 0.",hjust = 1,x=1,size = 10))

```

------------------------------------------------------------------------

#### ¿Qué tan seguro/a se siente caminando solo/a por su barrio cuando ya está oscuro?

```{r}
val_label(data_ola0$b2,99)<-"NS-NR"
val_label(data_ola0$b2,88)<-"NS-NR"

data_ola0 |>
  mutate(b2=to_label(b2),
         b2=dplyr::recode(b2,"Muy inseguro/a" = "Inseguro/a + Muy inseguro/a",
                             "Inseguro/a" = "Inseguro/a + Muy inseguro/a",
                             "Seguro/a" = "Seguro/a + Muy seguro/a",
                             "Muy seguro/a" = "Seguro/a + Muy seguro/a"),
         b2=factor(b2, levels=c(
           "Seguro/a + Muy seguro/a",
           "Inseguro/a + Muy inseguro/a",
           "NS-NR"
         ))) |>
  count(b2) |> 
  mutate(prop=(n/sum(n)*100)|>round(1))|>

  ggplot(aes(x=b2,y=prop,fill=b2))+
  geom_bar(position="dodge", stat="identity",color="black") +
  geom_text(aes(label=paste0(prop,"%")),
            vjust=-0.1,
            size=8) +
  theme_classic(base_size=20) +
  theme(axis.title.x = element_blank(),
        axis.title.y = element_blank())+
  scale_y_continuous(labels = function(x) paste0(x, "%"),limits = c(0,100))+
  scale_x_discrete(labels = function(x) str_wrap(x, width = 13))+
  scale_fill_manual(values = c("#440154","#440154","grey"))+
  guides(fill=FALSE)
```

------------------------------------------------------------------------

#### ¿Qué tan seguro/a se siente caminando solo/a por su barrio cuando ya está oscuro?

```{r}
ggarrange(

data_ola0 |> 
  proc_plot_demo(b2,sexo)|>
  mutate(b2=factor(b2,
                   levels=c("Muy inseguro/a",
                            "Inseguro/a",
                            "Seguro/a",
                            "Muy seguro/a",
                            "NS-NR"))) |>
  plot_propbar_sexo(fill_column="b2",fill_palette=palette_oles_5),


data_ola0 |> 
  proc_plot_demo(b2,edad_recod)|>
  mutate(b2=factor(b2,
                   levels=c("Muy inseguro/a",
                            "Inseguro/a",
                            "Seguro/a",
                            "Muy seguro/a",
                            "NS-NR"))) |>
  plot_propbar_edad(fill_column = "b2",fill_palette = palette_oles_5),

data_ola0 |>
  proc_plot_demo(b2,zona)|>
  mutate(b2=factor(b2,
                   levels=c("Muy inseguro/a",
                            "Inseguro/a",
                            "Seguro/a",
                            "Muy seguro/a",
                            "NS-NR"))) |> 
  plot_propbar_zona(fill_column = "b2",fill_palette = palette_oles_5),

 data_ola0 |>
  proc_plot_demo(b2,gse_recod)|>
  mutate(b2=factor(b2,
                   levels=c("Muy inseguro/a",
                            "Inseguro/a",
                            "Seguro/a",
                            "Muy seguro/a",
                            "NS-NR"))) |>
  plot_propbar_gse(fill_column = "b2",fill_palette = palette_oles_5),

ncol = 2, nrow = 2, align = "hv", 
          common.legend = TRUE
)|>
  annotate_figure(bottom=text_grob("Fuente: ESEP 2023, ola 0.",hjust = 1,x=1,size = 10))
```

# Eficacia de las policías {.r-fit-text background-image="img/oles_carabineros.webp"}

------------------------------------------------------------------------

#### Teniendo en cuenta su propia experiencia o lo que ha oído, ¿en qué medida se encuentra Ud. de acuerdo o en desacuerdo con las siguientes afirmaciones sobre Carabineros de Chile? {.smaller}

###### Carabineros logra controlar el problema de la delincuencia en Chile

```{r}

val_label(data_ola0$c1_1,99)<-"NS-NR"
val_label(data_ola0$c1_1,88)<-"NS-NR"

data_ola0 |>
  mutate(c1_1=to_label(c1_1))|>
  count(Variable=c1_1)|>
  mutate(prop=(n/nrow(data_ola0)*100)|>round(1),
         Item="Carabineros logra controlar el problema de la delincuencia en Chile",
         Variable=factor(Variable,levels=c(
                          "Muy en desacuerdo",
                          "En desacuerdo",
                          "Ni de acuerdo ni en desacuerdo",
                          "De acuerdo",
                          "Muy de Acuerdo",
                           "NS-NR")))|>
  
  ggplot(aes(x=prop,y=Variable,fill=Variable))+
  geom_bar(position="dodge", stat="identity",color="black") +
  geom_text(aes(label=paste0(prop,"%")),
            hjust=-0.1,
            size=8) +
  md_theme_classic(base_size=25) +
  theme(axis.title.x = element_blank(),
        axis.title.y = element_blank())+
  scale_x_continuous(labels = function(x) paste0(x, "%"),limits = c(0,100))+
  scale_y_discrete(labels = function(x) str_wrap(x, width = 10))+
  scale_fill_manual(values = c("#440154","#440154","#440154",
                               "#440154","#440154","grey"))+
  guides(fill=FALSE)
```

------------------------------------------------------------------------

#### Teniendo en cuenta su propia experiencia o lo que ha oído, ¿en qué medida se encuentra Ud. de acuerdo o en desacuerdo con las siguientes afirmaciones sobre Carabineros de Chile? {.smaller}

###### Carabineros logra controlar el problema de la delincuencia en Chile

```{r}
ggarrange(

data_ola0 |> 
  proc_plot_demo(c1_1, sexo) |>
  mutate(c1_1 = factor(c1_1,
                     levels = c(
                                "Muy en desacuerdo",
                                "En desacuerdo",
                                "Ni de acuerdo ni en desacuerdo",
                                "De acuerdo",
                                "Muy de Acuerdo",
                                "NS-NR"))) |>
  plot_propbar_sexo(fill_column = "c1_1", fill_palette = palette_oles_6),


data_ola0 |> 
  proc_plot_demo(c1_1, edad_recod) |>
  mutate(c1_1 = factor(c1_1,
                     levels = c(
                                "Muy en desacuerdo",
                                "En desacuerdo",
                                "Ni de acuerdo ni en desacuerdo",
                                "De acuerdo",
                                "Muy de Acuerdo",
                                "NS-NR"))) |>
  plot_propbar_edad(fill_column = "c1_1", fill_palette = palette_oles_6),

data_ola0 |>
  proc_plot_demo(c1_1, zona) |>
  mutate(c1_1 = factor(c1_1,
                     levels = c(
                                "Muy en desacuerdo",
                                "En desacuerdo",
                                "Ni de acuerdo ni en desacuerdo",
                                "De acuerdo",
                                "Muy de Acuerdo",
                                "NS-NR"))) |> 
  plot_propbar_zona(fill_column = "c1_1", fill_palette = palette_oles_6),

 data_ola0 |>
  proc_plot_demo(c1_1, gse_recod) |>
  mutate(c1_1 = factor(c1_1,
                     levels = c(
                                "Muy en desacuerdo",
                                "En desacuerdo",
                                "Ni de acuerdo ni en desacuerdo",
                                "De acuerdo",
                                "Muy de Acuerdo",
                                "NS-NR"))) |>
  plot_propbar_gse(fill_column = "c1_1", fill_palette = palette_oles_6),

ncol = 2, nrow = 2, align = "hv", 
common.legend = TRUE
)|>
  annotate_figure(bottom=text_grob("Fuente: ESEP 2023, ola 0.",hjust = 1,x=1,size = 10))
```

------------------------------------------------------------------------

#### Teniendo en cuenta su propia experiencia o lo que ha oído, ¿en qué medida se encuentra Ud. de acuerdo o en desacuerdo con las siguientes afirmaciones sobre Carabineros de Chile? {.smaller}

###### Carabineros logra controlar el problema del narcotráfico en Chile

```{r}
val_label(data_ola0$c1_2,99)<-"NS-NR"
val_label(data_ola0$c1_2,88)<-"NS-NR"

data_ola0 |>
  count(Variable=to_label(c1_2))|>
  mutate(prop=(n/nrow(data_ola0)*100)|>round(1),
         Item="Carabineros logra controlar el problema del narcotráfico en Chile",
                  Variable=factor(Variable,levels=c(
                          "Muy en desacuerdo",
                          "En desacuerdo",
                          "Ni de acuerdo ni en desacuerdo",
                          "De acuerdo",
                          "Muy de Acuerdo",
                          "NS-NR"))) |>

  ggplot(aes(x=prop,y=Variable,fill=Variable))+
  geom_bar(position="dodge", stat="identity",color="black") +
  geom_text(aes(label=paste0(prop,"%")),
            hjust=-0.1,
            size=8) +
  md_theme_classic(base_size=25) +
  theme(axis.title.x = element_blank(),
        axis.title.y = element_blank())+
  scale_x_continuous(labels = function(x) paste0(x, "%"),limits = c(0,100))+
  scale_y_discrete(labels = function(x) str_wrap(x, width = 10))+
  scale_fill_manual(values=c("#440154","#440154","#440154",
                             "#440154","#440154","grey"))+
  guides(fill=FALSE)
```

------------------------------------------------------------------------

#### Teniendo en cuenta su propia experiencia o lo que ha oído, ¿en qué medida se encuentra Ud. de acuerdo o en desacuerdo con las siguientes afirmaciones sobre Carabineros de Chile? {.smaller}

###### Carabineros logra controlar el problema del narcotráfico en Chile

```{r}
ggarrange(

data_ola0 |> 
  proc_plot_demo(c1_2, sexo) |>
  mutate(c1_2 = factor(c1_2,
                     levels = c("Muy en desacuerdo",
                                "En desacuerdo",
                                "Ni de acuerdo ni en desacuerdo",
                                "De acuerdo",
                                "Muy de Acuerdo",
                                "NS-NR"))) |>
  plot_propbar_sexo(fill_column = "c1_2", fill_palette = palette_oles_6),


data_ola0 |> 
  proc_plot_demo(c1_2, edad_recod) |>
  mutate(c1_2 = factor(c1_2,
                     levels = c("Muy en desacuerdo",
                                "En desacuerdo",
                                "Ni de acuerdo ni en desacuerdo",
                                "De acuerdo",
                                "Muy de Acuerdo",
                                "NS-NR"))) |>
  plot_propbar_edad(fill_column = "c1_2", fill_palette = palette_oles_6),

data_ola0 |>
  proc_plot_demo(c1_2, zona) |>
  mutate(c1_2 = factor(c1_2,
                     levels = c("Muy en desacuerdo",
                                "En desacuerdo",
                                "Ni de acuerdo ni en desacuerdo",
                                "De acuerdo",
                                "Muy de Acuerdo",
                                "NS-NR"))) |> 
  plot_propbar_zona(fill_column = "c1_2", fill_palette = palette_oles_6),

 data_ola0 |>
  proc_plot_demo(c1_2, gse_recod) |>
  mutate(c1_2 = factor(c1_2,
                     levels = c("Muy en desacuerdo",
                                "En desacuerdo",
                                "Ni de acuerdo ni en desacuerdo",
                                "De acuerdo",
                                "Muy de Acuerdo",
                                "NS-NR"))) |>
  plot_propbar_gse(fill_column = "c1_2", fill_palette = palette_oles_6),

ncol = 2, nrow = 2, align = "hv", 
common.legend = TRUE
)|>
  annotate_figure(bottom=text_grob("Fuente: ESEP 2023, ola 0.",hjust = 1,x=1,size = 10))


```

------------------------------------------------------------------------

#### Teniendo en cuenta su propia experiencia o lo que ha oído, ¿En qué medida se encuentra Ud. de acuerdo o en desacuerdo con las siguientes afirmaciones sobre la Policía de Investigaciones de Chile (PDI)? {.smaller}

###### La Policía de Investigaciones de Chile (PDI) logra controlar el problema de la delincuencia en Chile"

```{r}
val_label(data_ola0$c3,99)<-"NS-NR"
val_label(data_ola0$c3,88)<-"NS-NR"

data_ola0 |>
  count(Variable=to_label(c3))|>
  mutate(prop=(n/nrow(data_ola0)*100)|>round(1),
         Item="La PDI logra controlar el problema de la delincuencia en Chile",
         Variable=factor(Variable,levels=c(
                               "Muy en desacuerdo",
                                "En desacuerdo",
                                "Ni de acuerdo ni en desacuerdo",
                                "De acuerdo",
                                "Muy de Acuerdo",
                                "NS-NR"))) |>
  
  ggplot(aes(x=Variable,y=prop,fill=Variable))+
  geom_bar(position="dodge", stat="identity",color="black") +
  mdthemes::md_theme_classic(base_size=20) +
  theme(legend.position="top",
        axis.title.x = element_blank(),
        axis.title.y = element_blank())+
  scale_y_continuous(labels = function(x) paste0(x, "%"),limits = c(0,100))+
  geom_text(aes(label=paste0(prop,"%"),hjust=-0.1),size=6) +
  scale_fill_manual(values = c("#440154","#440154","#440154",
                               "#440154","#440154","grey"))+
  guides(fill=FALSE)+
  labs(caption="Fuente: ESEP 2023, ola 0.")+
  coord_flip()
```

------------------------------------------------------------------------

#### Teniendo en cuenta su propia experiencia o lo que ha oído, ¿En qué medida se encuentra Ud. de acuerdo o en desacuerdo con las siguientes afirmaciones sobre la Policía de Investigaciones de Chile (PDI)?

```{r}
ggarrange(

data_ola0 |> 
  proc_plot_demo(c3, sexo) |>
  mutate(c3 = factor(c3,
                     levels = c("Muy en desacuerdo",
                                "En desacuerdo",
                                "Ni de acuerdo ni en desacuerdo",
                                "De acuerdo",
                                "Muy de Acuerdo",
                                "NS-NR"))) |>
  plot_propbar_sexo(fill_column = "c3", fill_palette = palette_oles_6),


data_ola0 |> 
  proc_plot_demo(c3, edad_recod) |>
  mutate(c3 = factor(c3,
                     levels = c("Muy en desacuerdo",
                                "En desacuerdo",
                                "Ni de acuerdo ni en desacuerdo",
                                "De acuerdo",
                                "Muy de Acuerdo",
                                "NS-NR"))) |>
  plot_propbar_edad(fill_column = "c3", fill_palette = palette_oles_6),

data_ola0 |>
  proc_plot_demo(c3, zona) |>
  mutate(c3 = factor(c3,
                     levels = c("Muy en desacuerdo",
                                "En desacuerdo",
                                "Ni de acuerdo ni en desacuerdo",
                                "De acuerdo",
                                "Muy de Acuerdo",
                                "NS-NR"))) |> 
  plot_propbar_zona(fill_column = "c3", fill_palette = palette_oles_6),

 data_ola0 |>
  proc_plot_demo(c3, gse_recod) |>
  mutate(c3 = factor(c3,
                     levels = c("Muy en desacuerdo",
                                "En desacuerdo",
                                "Ni de acuerdo ni en desacuerdo",
                                "De acuerdo",
                                "Muy de Acuerdo",
                                "NS-NR"))) |>
  plot_propbar_gse(fill_column = "c3", fill_palette = palette_oles_6),

ncol = 2, nrow = 2, align = "hv", 
common.legend = TRUE
)|>
  annotate_figure(bottom=text_grob("Fuente: ESEP 2023, ola 0.",hjust = 1,x=1,size = 10))
```

# Legitimidad de policías {.r-fit-text background-image="img/oles_carabineros.webp"}

------------------------------------------------------------------------

#### Teniendo en cuenta su propia experiencia o lo que ha oído, ¿en qué medida se encuentra Ud. de acuerdo o en desacuerdo con las siguientes afirmaciones sobre Carabineros de Chile? {.smaller}

###### En general, los carabineros tienen la misma idea que yo sobre lo que está bien y lo que está mal

```{r}
val_label(data_ola0$c1_3,99)<-"NS-NR"
val_label(data_ola0$c1_3,88)<-"NS-NR"

data_ola0 |>
  count(Variable=to_label(c1_3))|>
  mutate(prop=(n/nrow(data_ola0)*100)|>round(1),
         Item="En general, los carabineros tienen la misma idea que yo sobre lo que está bien y lo que está mal",
                  Variable=factor(Variable,levels=c(
                          "Muy en desacuerdo",
                          "En desacuerdo",
                          "Ni de acuerdo ni en desacuerdo",
                          "De acuerdo",
                          "Muy de Acuerdo",
                           "NS-NR"))) |>

  ggplot(aes(x=Variable,y=prop,fill=Variable))+
  geom_bar(position="dodge", stat="identity",color="black") +
  geom_text(aes(label=paste0(prop,"%")),
            vjust=-0.1,
            size=8) +
  theme_classic(base_size=20) +
  theme(
        axis.title.x = element_blank(),
        axis.title.y = element_blank())+
  scale_y_continuous(labels = function(x) paste0(x, "%"),limits = c(0,100))+
  scale_x_discrete(labels = function(x) str_wrap(x, width = 10))+
  scale_fill_manual(values = c("#fde725","#fde725","#fde725",
                               "#fde725","#fde725","grey"))+
  guides(fill=FALSE)
```

------------------------------------------------------------------------

#### Teniendo en cuenta su propia experiencia o lo que ha oído, ¿en qué medida se encuentra Ud. de acuerdo o en desacuerdo con las siguientes afirmaciones sobre Carabineros de Chile? {.smaller}

###### En general, los carabineros tienen la misma idea que yo sobre lo que está bien y lo que está mal

```{r}
ggarrange(

data_ola0 |> 
  proc_plot_demo(c1_3, sexo) |>
  mutate(c1_3 = factor(c1_3,
                     levels = c("Muy en desacuerdo",
                                "En desacuerdo",
                                "Ni de acuerdo ni en desacuerdo",
                                "De acuerdo",
                                "Muy de Acuerdo",
                                "NS-NR"))) |>
  plot_propbar_sexo(fill_column = "c1_3", fill_palette = palette_oles_6),


data_ola0 |> 
  proc_plot_demo(c1_3, edad_recod) |>
  mutate(c1_3 = factor(c1_3,
                     levels = c("Muy en desacuerdo",
                                "En desacuerdo",
                                "Ni de acuerdo ni en desacuerdo",
                                "De acuerdo",
                                "Muy de Acuerdo",
                                "NS-NR"))) |>
  plot_propbar_edad(fill_column = "c1_3", fill_palette = palette_oles_6),

data_ola0 |>
  proc_plot_demo(c1_3, zona) |>
  mutate(c1_3 = factor(c1_3,
                     levels = c("Muy en desacuerdo",
                                "En desacuerdo",
                                "Ni de acuerdo ni en desacuerdo",
                                "De acuerdo",
                                "Muy de Acuerdo",
                                "NS-NR"))) |> 
  plot_propbar_zona(fill_column = "c1_3", fill_palette = palette_oles_6),

 data_ola0 |>
  proc_plot_demo(c1_3, gse_recod) |>
  mutate(c1_3 = factor(c1_3,
                     levels = c("Muy en desacuerdo",
                                "En desacuerdo",
                                "Ni de acuerdo ni en desacuerdo",
                                "De acuerdo",
                                "Muy de Acuerdo",
                                "NS-NR"))) |>
  plot_propbar_gse(fill_column = "c1_3", fill_palette = palette_oles_6),

ncol = 2, nrow = 2, align = "hv", 
common.legend = TRUE
)|>
  annotate_figure(bottom=text_grob("Fuente: ESEP 2023, ola 0.",hjust = 1,x=1,size = 10))
```

------------------------------------------------------------------------

#### Teniendo en cuenta su propia experiencia o lo que ha oído, ¿en qué medida se encuentra Ud. de acuerdo o en desacuerdo con las siguientes afirmaciones sobre Carabineros de Chile? {.smaller}

###### Hay que respetar las decisiones que toman los carabineros, aunque no se esté de acuerdo con ellas

```{r}
data_ola0 <- data_ola0 %>%
  mutate(c1_4 = if_else(is.na(c1_4), 99, c1_4))

val_label(data_ola0$c1_4,99)<-"NS-NR"
val_label(data_ola0$c1_4,88)<-"NS-NR"

# Falta arreglar la introducción de NA
data_ola0 |>
  count(Variable=to_label(c1_4))|>
  group_by(Variable)|>
  summarise(n=sum(n))|>
  ungroup()|>
  mutate(prop=(n/nrow(data_ola0)*100)|>round(1),
         Item="Hay que respetar las decisiones que toman los carabineros, aunque no se esté de acuerdo con ellas",
                  Variable=factor(Variable,levels=c(
                          "Muy en desacuerdo",
                          "En desacuerdo",
                          "Ni de acuerdo ni en desacuerdo",
                          "De acuerdo",
                          "Muy de Acuerdo",
                           "NS-NR"))) |>

  ggplot(aes(x=Variable,y=prop,fill=Variable))+
  geom_bar(position="dodge", stat="identity",color="black") +
  geom_text(aes(label=paste0(prop,"%")),
            vjust=-0.1,
            size=8) +
  theme_classic(base_size=20) +
  theme(
        axis.title.x = element_blank(),
        axis.title.y = element_blank())+
  scale_y_continuous(labels = function(x) paste0(x, "%"),limits = c(0,100))+
  scale_x_discrete(labels = function(x) str_wrap(x, width = 10))+
  scale_fill_manual(values = c("#fde725","#fde725","#fde725",
                               "#fde725","#fde725","grey"))+
  guides(fill=FALSE)

```

------------------------------------------------------------------------

#### Teniendo en cuenta su propia experiencia o lo que ha oído, ¿en qué medida se encuentra Ud. de acuerdo o en desacuerdo con las siguientes afirmaciones sobre Carabineros de Chile? {.smaller}

###### Hay que respetar las decisiones que toman los carabineros, aunque no se esté de acuerdo con ellas

```{r}
ggarrange(

data_ola0 |> 
  proc_plot_demo(c1_4, sexo) |>
  mutate(c1_4 = factor(c1_4,
                     levels = c("Muy en desacuerdo",
                                "En desacuerdo",
                                "Ni de acuerdo ni en desacuerdo",
                                "De acuerdo",
                                "Muy de Acuerdo",
                                "NS-NR"))) |>
  plot_propbar_sexo(fill_column = "c1_4", fill_palette = palette_oles_6),


data_ola0 |> 
  proc_plot_demo(c1_4, edad_recod) |>
  mutate(c1_4 = factor(c1_4,
                     levels = c("Muy en desacuerdo",
                                "En desacuerdo",
                                "Ni de acuerdo ni en desacuerdo",
                                "De acuerdo",
                                "Muy de Acuerdo",
                                "NS-NR"))) |>
  plot_propbar_edad(fill_column = "c1_4", fill_palette = palette_oles_6),

data_ola0 |>
  proc_plot_demo(c1_4, zona) |>
  mutate(c1_4 = factor(c1_4,
                     levels = c("Muy en desacuerdo",
                                "En desacuerdo",
                                "Ni de acuerdo ni en desacuerdo",
                                "De acuerdo",
                                "Muy de Acuerdo",
                                "NS-NR"))) |> 
  plot_propbar_zona(fill_column = "c1_4", fill_palette = palette_oles_6),

 data_ola0 |>
  proc_plot_demo(c1_4, gse_recod) |>
  mutate(c1_4 = factor(c1_4,
                     levels = c("Muy en desacuerdo",
                                "En desacuerdo",
                                "Ni de acuerdo ni en desacuerdo",
                                "De acuerdo",
                                "Muy de Acuerdo",
                                "NS-NR"))) |>
  plot_propbar_gse(fill_column = "c1_4", fill_palette = palette_oles_6),

ncol = 2, nrow = 2, align = "hv", 
common.legend = TRUE
)|>
  annotate_figure(bottom=text_grob("Fuente: ESEP 2023, ola 0.",hjust = 1,x=1,size = 10))
```

# Justicia procedimental de las policías {.r-fit-text background-image="img/oles_carabineros.webp"}

------------------------------------------------------------------------

#### Teniendo en cuenta su propia experiencia o lo que ha oído, ¿con qué frecuencia cree Ud. que los carabineros...? {.smaller}

###### Toman decisiones justas e imparciales en los casos que se ocupa

```{r}
val_label(data_ola0$c2_1,99)<-"NS-NR"
val_label(data_ola0$c2_1,88)<-"NS-NR"

data_ola0 |>
  count(Variable=to_label(c2_1))|>
  mutate(prop=(n/nrow(data_ola0)*100)|>round(1),
         Item="tratan a las personas con respeto en Chile")|>
  mutate(Variable=factor(Variable,levels=c(
    "Nunca",
    "Pocas veces",
    "Algunas veces",
    "Casi siempre",
    "Siempre",
    "NS-NR"
  )))|>

  ggplot(aes(x=Variable,y=prop,fill=Variable))+
  geom_bar(position="dodge", stat="identity",color="black") +
  mdthemes::md_theme_classic(base_size=20) +
  theme(legend.position="top",
        axis.title.x = element_blank(),
        axis.title.y = element_blank())+
  scale_y_continuous(labels = function(x) paste0(x, "%"),limits = c(0,100))+
  scale_x_discrete(labels = function(x) str_wrap(x, width = 8))+
  geom_text(aes(label=paste0(prop,"%"),vjust=-0.2),size=6) +
  scale_fill_manual(values=c("#440154","#440154","#440154",
                               "#440154","#440154","grey"))+
  guides(fill=FALSE)

```

------------------------------------------------------------------------

#### Teniendo en cuenta su propia experiencia o lo que ha oído, ¿con qué frecuencia cree Ud. que los carabineros...? {.smaller}

###### Los carabineros toman decisiones justas e imparciales en los casos que se ocupa

```{r}
ggarrange(

data_ola0 |> 
  proc_plot_demo(c2_1, sexo) |>
  mutate(c2_1 = factor(c2_1,
                     levels = c(
    "Nunca",
    "Pocas veces",
    "Algunas veces",
    "Casi siempre",
    "Siempre",
    "NS-NR"))) |>
  plot_propbar_sexo(fill_column = "c2_1", fill_palette = palette_oles_6),


data_ola0 |> 
  proc_plot_demo(c2_1, edad_recod) |>
  mutate(c2_1 = factor(c2_1,
                     levels = c(
    "Nunca",
    "Pocas veces",
    "Algunas veces",
    "Casi siempre",
    "Siempre",
    "NS-NR"
                     ))) |>
  plot_propbar_edad(fill_column = "c2_1", fill_palette = palette_oles_6),

data_ola0 |>
  proc_plot_demo(c2_1, zona) |>
  mutate(c2_1 = factor(c2_1,
                     levels = c("Nunca",
    "Pocas veces",
    "Algunas veces",
    "Casi siempre",
    "Siempre",
    "NS-NR"))) |> 
  plot_propbar_zona(fill_column = "c2_1", fill_palette = palette_oles_6),

 data_ola0 |>
  proc_plot_demo(c2_1, gse_recod) |>
  mutate(c2_1 = factor(c2_1,
                     levels = c("Nunca",
    "Pocas veces",
    "Algunas veces",
    "Casi siempre",
    "Siempre",
    "NS-NR"))) |>
  plot_propbar_gse(fill_column = "c2_1", fill_palette = palette_oles_6),

ncol = 2, nrow = 2, align = "hv", 
common.legend = TRUE
)|>
  annotate_figure(bottom=text_grob("Fuente: ESEP 2023, ola 0.",hjust = 1,x=1,size = 10))
```

------------------------------------------------------------------------

#### Teniendo en cuenta su propia experiencia o lo que ha oído, ¿con qué frecuencia cree Ud. que los carabineros...? {.smaller}

###### Tratan a las personas con respeto en Chile

```{r}
val_label(data_ola0$c2_2,99)<-"NS-NR"
val_label(data_ola0$c2_2,88)<-"NS-NR"


data_ola0 |>
  count(Variable=to_label(c2_2)) |>
  mutate(prop=(n/nrow(data_ola0)*100)|>round(1),
         Item="Toman decisiones justas e imparciales en los casos que se ocupa?") |>
    mutate(Variable=factor(Variable,levels=c(
    "Nunca",
    "Pocas veces",
    "Algunas veces",
    "Casi siempre",
    "Siempre",
    "NS-NR"
  )))|>
  
  ggplot(aes(x=Variable,y=prop,fill=Variable))+
  geom_bar(position="dodge", stat="identity",color="black") +
  mdthemes::md_theme_classic(base_size=20) +
  theme(legend.position="top",
        axis.title.x = element_blank(),
        axis.title.y = element_blank())+
  scale_y_continuous(labels = function(x) paste0(x, "%"),limits = c(0,100))+
  geom_text(aes(label=paste0(prop,"%"),vjust=-0.2),size=6) +
  scale_fill_manual(values = c("#440154","#440154","#440154",
                               "#440154","#440154","grey"))+
  scale_x_discrete(labels = function(x) str_wrap(x, width = 8))+
  guides(fill=FALSE)
```

------------------------------------------------------------------------

#### Teniendo en cuenta su propia experiencia o lo que ha oído, ¿con qué frecuencia cree Ud. que los carabineros...? {.smaller}

###### Los carabineros tratan a las personas con respeto en los casos que se ocupa

```{r}
ggarrange(

data_ola0 |> 
  proc_plot_demo(c2_2, sexo) |>
  mutate(c2_2 = factor(c2_2,
                     levels = c(
    "Nunca",
    "Pocas veces",
    "Algunas veces",
    "Casi siempre",
    "Siempre",
    "NS-NR"))) |>
  plot_propbar_sexo(fill_column = "c2_2", fill_palette = palette_oles_6),


data_ola0 |> 
  proc_plot_demo(c2_2, edad_recod) |>
  mutate(c2_2 = factor(c2_2,
                     levels = c(
    "Nunca",
    "Pocas veces",
    "Algunas veces",
    "Casi siempre",
    "Siempre",
    "NS-NR"
                     ))) |>
  plot_propbar_edad(fill_column = "c2_2", fill_palette = palette_oles_6),

data_ola0 |>
  proc_plot_demo(c2_2, zona) |>
  mutate(c2_2 = factor(c2_2,
                     levels = c("Nunca",
    "Pocas veces",
    "Algunas veces",
    "Casi siempre",
    "Siempre",
    "NS-NR"))) |> 
  plot_propbar_zona(fill_column = "c2_2", fill_palette = palette_oles_6),

 data_ola0 |>
  proc_plot_demo(c2_2, gse_recod) |>
  mutate(c2_2 = factor(c2_2,
                     levels = c("Nunca",
    "Pocas veces",
    "Algunas veces",
    "Casi siempre",
    "Siempre",
    "NS-NR"))) |>
  plot_propbar_gse(fill_column = "c2_2", fill_palette = palette_oles_6),

ncol = 2, nrow = 2, align = "hv", 
common.legend = TRUE
)|>
  annotate_figure(bottom=text_grob("Fuente: ESEP 2023, ola 0.",hjust = 1,x=1,size = 10))
```

------------------------------------------------------------------------

#### Teniendo en cuenta su propia experiencia o lo que ha oído, ¿con qué frecuencia cree Ud. que los funcionarios de la PDI...? {.smaller}

###### Toman decisiones justas e imparciales en los casos que se ocupa

```{r}
val_label(data_ola0$c4_1,99)<-"NS-NR"
val_label(data_ola0$c4_1,88)<-"NS-NR"

data_ola0 |>
  count(Variable=to_label(c4_1))|>
  mutate(prop=(n/nrow(data_ola0)*100)|>round(1))|>
  
  ggplot(aes(x=Variable,y=prop,fill=Variable))+
  geom_bar(position="dodge", stat="identity",color="black") +
  mdthemes::md_theme_classic(base_size=20) +
  theme(legend.position="top",
        axis.title.x = element_blank(),
        axis.title.y = element_blank())+
  scale_y_continuous(labels = function(x) paste0(x, "%"),limits = c(0,100))+
  geom_text(aes(label=paste0(prop,"%"),vjust=-0.2),size=6) +
  scale_fill_manual(values = c("#440154","#440154","#440154",
                               "#440154","#440154","grey"))+
  guides(fill=FALSE)+
  labs(caption="Fuente: ESEP 2023, Ola 0.")

```

------------------------------------------------------------------------

#### Teniendo en cuenta su propia experiencia o lo que ha oído, ¿con qué frecuencia cree Ud. que los funcionarios de la PDI...? {.smaller}

###### Los funcionarios de la PDI toman decisiones justas e imparciales en los casos que se ocupa

```{r}
ggarrange(

data_ola0 |> 
  proc_plot_demo(c4_1, sexo) |>
  mutate(c4_1 = factor(c4_1,
                     levels = c(
    "Nunca",
    "Pocas veces",
    "Algunas veces",
    "Casi siempre",
    "Siempre",
    "NS-NR"))) |>
  plot_propbar_sexo(fill_column = "c4_1", fill_palette = palette_oles_6),


data_ola0 |> 
  proc_plot_demo(c4_1, edad_recod) |>
  mutate(c4_1 = factor(c4_1,
                     levels = c(
    "Nunca",
    "Pocas veces",
    "Algunas veces",
    "Casi siempre",
    "Siempre",
    "NS-NR"
                     ))) |>
  plot_propbar_edad(fill_column = "c4_1", fill_palette = palette_oles_6),

data_ola0 |>
  proc_plot_demo(c4_1, zona) |>
  mutate(c4_1 = factor(c4_1,
                     levels = c("Nunca",
    "Pocas veces",
    "Algunas veces",
    "Casi siempre",
    "Siempre",
    "NS-NR"))) |> 
  plot_propbar_zona(fill_column = "c4_1", fill_palette = palette_oles_6),

 data_ola0 |>
  proc_plot_demo(c4_1, gse_recod) |>
  mutate(c4_1 = factor(c4_1,
                     levels = c("Nunca",
    "Pocas veces",
    "Algunas veces",
    "Casi siempre",
    "Siempre",
    "NS-NR"))) |>
  plot_propbar_gse(fill_column = "c4_1", fill_palette = palette_oles_6),

ncol = 2, nrow = 2, align = "hv", 
common.legend = TRUE
)|>
  annotate_figure(bottom=text_grob("Fuente: ESEP 2023, ola 0.",hjust = 1,x=1,size = 10))
```

------------------------------------------------------------------------

#### Teniendo en cuenta su propia experiencia o lo que ha oído, ¿con qué frecuencia cree Ud. que los funcionarios de la PDI...? {.smaller}

###### Tratan a las personas con respeto en Chile

```{r}

val_label(data_ola0$c4_2,99)<-"NS-NR"
val_label(data_ola0$c4_2,88)<-"NS-NR"

data_ola0 |>
  count(Variable=to_label(c4_2)) |>
  mutate(prop=(n/nrow(data_ola0)*100)|>round(1),
         Item="Toman decisiones justas e imparciales en los casos que se ocupa?") |>
  
  ggplot(aes(x=Variable,y=prop,fill=Variable))+
  geom_bar(position="dodge", stat="identity",color="black") +
  mdthemes::md_theme_classic(base_size=20) +
  theme(legend.position="top",
        axis.title.x = element_blank(),
        axis.title.y = element_blank())+
  scale_y_continuous(labels = function(x) paste0(x, "%"),limits = c(0,100))+
  geom_text(aes(label=paste0(prop,"%"),vjust=-0.2),size=6)+
  scale_fill_manual(values = c("#440154","#440154","#440154",
                               "#440154","#440154","grey"))+
  guides(fill=FALSE)+
  labs(caption="Fuente: ESEP 2023, Ola 0.")
```

------------------------------------------------------------------------

#### Teniendo en cuenta su propia experiencia o lo que ha oído, ¿con qué frecuencia cree Ud. que los funcionarios de la PDI...? {.smaller}

###### Los funcionarios de la PDI tratan a las personas con respeto en los casos que se ocupa

```{r}
ggarrange(

data_ola0 |> 
  proc_plot_demo(c4_2, sexo) |>
  mutate(c4_2 = factor(c4_2,
                     levels = c(
    "Nunca",
    "Pocas veces",
    "Algunas veces",
    "Casi siempre",
    "Siempre",
    "NS-NR"))) |>
  plot_propbar_sexo(fill_column = "c4_2", fill_palette = palette_oles_6),


data_ola0 |> 
  proc_plot_demo(c4_2, edad_recod) |>
  mutate(c4_2 = factor(c4_2,
                     levels = c(
    "Nunca",
    "Pocas veces",
    "Algunas veces",
    "Casi siempre",
    "Siempre",
    "NS-NR"
                     ))) |>
  plot_propbar_edad(fill_column = "c4_2", fill_palette = palette_oles_6),

data_ola0 |>
  proc_plot_demo(c4_2, zona) |>
  mutate(c4_2 = factor(c4_2,
                     levels = c("Nunca",
    "Pocas veces",
    "Algunas veces",
    "Casi siempre",
    "Siempre",
    "NS-NR"))) |> 
  plot_propbar_zona(fill_column = "c4_2", fill_palette = palette_oles_6),

 data_ola0 |>
  proc_plot_demo(c4_2, gse_recod) |>
  mutate(c4_2 = factor(c4_2,
                     levels = c("Nunca",
    "Pocas veces",
    "Algunas veces",
    "Casi siempre",
    "Siempre",
    "NS-NR"))) |>
  plot_propbar_gse(fill_column = "c4_2", fill_palette = palette_oles_6),

ncol = 2, nrow = 2, align = "hv", 
common.legend = TRUE
)|>
  annotate_figure(bottom=text_grob("Fuente: ESEP 2023, ola 0.",hjust = 1,x=1,size = 10))
```

# Confianza en las policías

------------------------------------------------------------------------

#### ¿Podría Ud. decirme cuánta confianza tiene cada una de estas instituciones?

```{r}
val_label(data_ola0$c5_1,99)<-"NS-NR"
val_label(data_ola0$c5_1,88)<-"NS-NR"
val_label(data_ola0$c5_2,99)<-"NS-NR"
val_label(data_ola0$c5_2,88)<-"NS-NR"

rbind(
data_ola0 |>
  count(Variable=to_label(c5_1)) |>
  mutate(prop=(n/nrow(data_ola0)*100),
         Item="Carabineros de Chile",
         prop=round(prop,1)),
data_ola0 |>
  count(Variable=to_label(c5_2)) |>
  mutate(prop=(n/nrow(data_ola0)*100),
         Item="Policía de Investigaciones",
         prop=round(prop,1))
) |>
  
  ggplot(aes(x=Variable,y=prop,fill=Item))+
  geom_bar(position="dodge", stat="identity",color="black") +
  mdthemes::md_theme_classic(base_size=20) +
  theme(legend.position="top",
        axis.title.x = element_blank(),
        axis.title.y = element_blank())+
  scale_y_continuous(labels = function(x) paste0(x, "%"))+
  scale_fill_manual(values = palette_oles_2)+
  scale_y_continuous(labels = function(x) paste0(x, "%"),limits = c(0,100))+
  geom_text(aes(label=paste0(prop,"%"),vjust=-0.2),position = position_dodge(1),vjust=0.5,hjust=-0.1,size=7) +
  coord_flip()+
  labs(fill="",
       caption="Fuente: ESEP 2023, Ola 0")+
  guides(fill = guide_legend(reverse = TRUE))
```

------------------------------------------------------------------------

#### ¿Podría Ud. decirme cuánta confianza tiene en Carabineros de Chile?

```{r}
ggarrange(

data_ola0 |> 
  proc_plot_demo(c5_1, sexo) |>
  plot_propbar_sexo(fill_column = "c5_1", fill_palette = palette_oles_5),


data_ola0 |> 
  proc_plot_demo(c5_1, edad_recod) |>
  plot_propbar_edad(fill_column = "c5_1", fill_palette = palette_oles_5),

data_ola0 |>
  proc_plot_demo(c5_1, zona) |>
  plot_propbar_zona(fill_column = "c5_1", fill_palette = palette_oles_5),

 data_ola0 |>
  proc_plot_demo(c5_1, gse_recod) |>
  plot_propbar_gse(fill_column = "c5_1", fill_palette = palette_oles_5),

ncol = 2, nrow = 2, align = "hv", 
common.legend = TRUE
)|>
  annotate_figure(bottom=text_grob("Fuente: ESEP 2023, ola 0.",hjust = 1,x=1,size = 10))
```

------------------------------------------------------------------------

#### ¿Podría Ud. decirme cuánta confianza tiene en la Policiía de Investigaciones (PDI)?

```{r}
ggarrange(

data_ola0 |> 
  proc_plot_demo(c5_2, sexo) |>
  plot_propbar_sexo(fill_column = "c5_2", fill_palette = palette_oles_5),


data_ola0 |> 
  proc_plot_demo(c5_2, edad_recod) |>
  plot_propbar_edad(fill_column = "c5_2", fill_palette = palette_oles_5),

data_ola0 |>
  proc_plot_demo(c5_2, zona) |>
  plot_propbar_zona(fill_column = "c5_2", fill_palette = palette_oles_5),

 data_ola0 |>
  proc_plot_demo(c5_2, gse_recod) |>
  plot_propbar_gse(fill_column = "c5_2", fill_palette = palette_oles_5),

ncol = 2, nrow = 2, align = "hv", 
common.legend = TRUE
)|>
  annotate_figure(bottom=text_grob("Fuente: ESEP 2023, ola 0.",hjust = 1,x=1,size = 10))
```

# Empoderamiento de las policías {.r-fit-text background-image="img/oles_carabineros.webp"}

------------------------------------------------------------------------

#### ¿Qué tan de acuerdo o en desacuerdo se encuentra usted con las siguientes medidas? {.smaller}

###### Endurecer las penas contra quienes atenten contra la integridad física de Carabineros, PDI y Gendarmería

```{r}
val_label(data_ola0$c7_1,99)<-"NS-NR"
val_label(data_ola0$c7_1,88)<-"NS-NR"

data_ola0 |>
  count(Variable=to_label(c7_1)) |>
  mutate(prop=(n/nrow(data_ola0)*100),
                  Variable=factor(Variable,levels=c(
                          "Muy en desacuerdo",
                          "En desacuerdo",
                          "Ni de acuerdo ni en desacuerdo",
                          "De acuerdo",
                          "Muy de Acuerdo",
                           "NS-NR")),
         prop=round(prop,1)) |>
  
  ggplot(aes(x=Variable,y=prop,fill=Variable))+
  geom_bar(position="dodge", stat="identity",color="black") +
  theme_classic(base_size=20) +
  theme(legend.position="top",
        axis.title.x = element_blank(),
        axis.title.y = element_blank())+
  scale_y_continuous(labels = function(x) paste0(x, "%"),limits = c(0,100))+
  scale_x_discrete(labels = function(x) str_wrap(x, width = 10)) +
  scale_fill_manual(values = c("#fde725","#fde725","#fde725",
                               "#fde725","#fde725","grey"))+
  geom_text(aes(label=paste0(prop,"%"),vjust=-0.2),size=7) +
  guides(fill=FALSE)+
  labs(caption="Fuente: ESEP 2023, Ola 0")
```

------------------------------------------------------------------------

#### ¿Qué tan de acuerdo o en desacuerdo se encuentra usted con las siguientes medidas? {.smaller}

###### Endurecer las penas contra quienes atenten contra la integridad física de Carabineros, PDI y Gendarmería

```{r}
ggarrange(

data_ola0 |> 
  proc_plot_demo(c7_1, sexo) |>
  mutate(c7_1 = factor(c7_1,
                     levels = c("Muy en desacuerdo",
                                "En desacuerdo",
                                "Ni de acuerdo ni en desacuerdo",
                                "De acuerdo",
                                "Muy de Acuerdo",
                                "NS-NR"))) |>
  plot_propbar_sexo(fill_column = "c7_1", fill_palette = palette_oles_6),


data_ola0 |> 
  proc_plot_demo(c7_1, edad_recod) |>
  mutate(c7_1 = factor(c7_1,
                     levels = c("Muy en desacuerdo",
                                "En desacuerdo",
                                "Ni de acuerdo ni en desacuerdo",
                                "De acuerdo",
                                "Muy de Acuerdo",
                                "NS-NR"))) |>
  plot_propbar_edad(fill_column = "c7_1", fill_palette = palette_oles_6),

data_ola0 |>
  proc_plot_demo(c7_1, zona) |>
  mutate(c7_1 = factor(c7_1,
                     levels = c("Muy en desacuerdo",
                                "En desacuerdo",
                                "Ni de acuerdo ni en desacuerdo",
                                "De acuerdo",
                                "Muy de Acuerdo",
                                "NS-NR"))) |> 
  plot_propbar_zona(fill_column = "c7_1", fill_palette = palette_oles_6),

 data_ola0 |>
  proc_plot_demo(c7_1, gse_recod) |>
  mutate(c7_1 = factor(c7_1,
                     levels = c("Muy en desacuerdo",
                                "En desacuerdo",
                                "Ni de acuerdo ni en desacuerdo",
                                "De acuerdo",
                                "Muy de Acuerdo",
                                "NS-NR"))) |>
  plot_propbar_gse(fill_column = "c7_1", fill_palette = palette_oles_6),

ncol = 2, nrow = 2, align = "hv", 
common.legend = TRUE
)|>
  annotate_figure(bottom=text_grob("Fuente: ESEP 2023, ola 0.",hjust = 1,x=1,size = 10))
```

------------------------------------------------------------------------

#### ¿Qué tan de acuerdo o en desacuerdo se encuentra usted con las siguientes medidas? {.smaller}

###### Dar mayores facilidades para que los carabineros puedan usar su arma de servicio cuando lo estimen necesario

```{r}
val_label(data_ola0$c7_2,99)<-"NS-NR"
val_label(data_ola0$c7_2,88)<-"NS-NR"

data_ola0 |>
  count(Variable=to_label(c7_2)) |>
  mutate(prop=(n/nrow(data_ola0)*100),
                  Variable=factor(Variable,levels=c(
                          "Muy en desacuerdo",
                          "En desacuerdo",
                          "Ni de acuerdo ni en desacuerdo",
                          "De acuerdo",
                          "Muy de Acuerdo",
                           "NS-NR")),
         prop=round(prop,1))|>
  
  ggplot(aes(x=Variable,y=prop,fill=Variable))+
  geom_bar(position="dodge", stat="identity",color="black") +
  theme_classic(base_size=20) +
  theme(legend.position="top",
        axis.title.x = element_blank(),
        axis.title.y = element_blank())+
  scale_y_continuous(labels = function(x) paste0(x, "%"),limits = c(0,100))+
  scale_x_discrete(labels = function(x) str_wrap(x, width = 10)) +
  scale_fill_manual(values=c("#fde725","#fde725","#fde725",
                             "#fde725","#fde725","grey"))+
  geom_text(aes(label=paste0(prop,"%"),vjust=-0.2),size=7) +
  guides(fill=FALSE)+
  labs(caption="Fuente: ESEP 2023, Ola 0")
```

------------------------------------------------------------------------

#### ¿Qué tan de acuerdo o en desacuerdo se encuentra usted con las siguientes medidas? {.smaller}

###### Dar mayores facilidades para que los carabineros puedan usar su arma de servicio cuando lo estimen necesario

```{r}
ggarrange(

data_ola0 |> 
  proc_plot_demo(c7_2, sexo) |>
  mutate(c7_2 = factor(c7_2,
                     levels = c("Muy en desacuerdo",
                                "En desacuerdo",
                                "Ni de acuerdo ni en desacuerdo",
                                "De acuerdo",
                                "Muy de Acuerdo",
                                "NS-NR"))) |>
  plot_propbar_sexo(fill_column = "c7_2", fill_palette = palette_oles_6),


data_ola0 |> 
  proc_plot_demo(c7_2, edad_recod) |>
  mutate(c7_2 = factor(c7_2,
                     levels = c("Muy en desacuerdo",
                                "En desacuerdo",
                                "Ni de acuerdo ni en desacuerdo",
                                "De acuerdo",
                                "Muy de Acuerdo",
                                "NS-NR"))) |>
  plot_propbar_edad(fill_column = "c7_2", fill_palette = palette_oles_6),

data_ola0 |>
  proc_plot_demo(c7_2, zona) |>
  mutate(c7_2 = factor(c7_2,
                     levels = c("Muy en desacuerdo",
                                "En desacuerdo",
                                "Ni de acuerdo ni en desacuerdo",
                                "De acuerdo",
                                "Muy de Acuerdo",
                                "NS-NR"))) |> 
  plot_propbar_zona(fill_column = "c7_2", fill_palette = palette_oles_6),

 data_ola0 |>
  proc_plot_demo(c7_2, gse_recod) |>
  mutate(c7_2 = factor(c7_2,
                     levels = c("Muy en desacuerdo",
                                "En desacuerdo",
                                "Ni de acuerdo ni en desacuerdo",
                                "De acuerdo",
                                "Muy de Acuerdo",
                                "NS-NR"))) |>
  plot_propbar_gse(fill_column = "c7_2", fill_palette = palette_oles_6),

ncol = 2, nrow = 2, align = "hv", 
common.legend = TRUE
)|>
  annotate_figure(bottom=text_grob("Fuente: ESEP 2023, ola 0.",hjust = 1,x=1,size = 10))
```


