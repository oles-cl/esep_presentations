---
title: "Estudio de Percepciones de Seguridad y Policias en Chile 2023-2025"
subtitle: "Reporte de resultados Ola 0"
author: "Observatorio de Violencia y Legitimidad Social"
date: 01-03-2024
format: 
  revealjs:
    logo: img/oles_logo.png
    multiplex: true
    theme: ["pp.scss"]
    footer: "[Visita nuestro sitio web www.oles.cl](https://oles2.netlify.app/)"
    slide-number: c/t
editor: visual
---

```{r setup}
#| include: false

pacman::p_load(tidyverse,
               ggplot2,
               knitr,
               kableExtra,
               haven,
               labelled,
               sjlabelled,
               ggrepel,
               mdthemes,
               readxl,
               stringr,
               wrapr,
               scales,
               janitor,
               ggpubr,
               forcats,
               gt
               )

level_likert_1 <- c(
  "Muy en desacuerdo",
  "En desacuerdo",
  "Ni de acuerdo ni en desacuerdo",
  "De acuerdo",         
  "Muy de acuerdo")

palette_likert_5 <- c(
  "#fde725",
  "#5ec962",
  "#21918c",
  "#3b528b",
  "#440154"
)

palette_likert_4 <-c(
  "#fde725",
  "#35b779",
  "#31688e",
  "#440154"
)

palette_oles_4 <-c(
  "#fde725",
  "#35b779",
  "#31688e",
  "#440154"
)

palette_oles_3 <- c(
  "#fde725",
  "#21918c",
  "#440154"
)

palette_oles_2 <- c(
  "#fde725",
  "#440154"
)



#funcion demográficas sexo
plot_propbar_sexo<- function(x,fill_column,fill_palette) {
  x |>
  ggplot(aes(x = sexo, y = n, fill = !!as.name(fill_column))) +
    geom_bar(position = "fill", stat = "identity", color = "black", width = 0.6) +
    geom_text(aes(label = label), position = position_fill(vjust = 0.5), size = 3, color = "black") +
    coord_flip() +
    theme_classic() +
    theme(legend.position = "top",
          axis.title.x = element_blank(),
          axis.title.y = element_blank()) +
    labs(fill = "") +
    scale_fill_manual(values = fill_palette) +
    scale_y_continuous(labels = function(x) paste0(x * 100, "%"))+
    guides(fill = guide_legend(reverse = TRUE))
}

#función demográficas edad
plot_propbar_edad <- function(x,fill_column,fill_palette) {
  x|>
  ggplot(aes(x = edad_recod, y = n, fill = !!as.name(fill_column))) +
    geom_bar(position = "fill", stat = "identity", color = "black", width = 0.6) +
    geom_text(aes(label = label), position = position_fill(vjust = 0.5), size = 3, color = "black") +
    coord_flip() +
    theme_classic() +
    theme(legend.position = "top",
          axis.title.x = element_blank(),
          axis.title.y = element_blank()) +
    labs(fill = "") +
    scale_fill_manual(values = fill_palette) +
    scale_y_continuous(labels = function(x) paste0(x * 100, "%"))+
    guides(fill = guide_legend(reverse = TRUE))
}

#función propbar zona
plot_propbar_zona <- function(x,fill_column,fill_palette) {
  x|>
  ggplot(aes(x = zona, y = n, fill = !!as.name(fill_column))) +
    geom_bar(position = "fill", stat = "identity", color = "black", width = 0.6) +
    geom_text(aes(label = label), position = position_fill(vjust = 0.5), size = 3, color = "black") +
    coord_flip() +
    theme_classic() +
    theme(legend.position = "top",
          axis.title.x = element_blank(),
          axis.title.y = element_blank()) +
    labs(fill = "") +
    scale_fill_manual(values = fill_palette) +
    scale_y_continuous(labels = function(x) paste0(x * 100, "%"))+
    guides(fill = guide_legend(reverse = TRUE))
}

#función propbar gse
plot_propbar_gse <- function(x,fill_column,fill_palette) {
  x|>
  ggplot(aes(x = gse_recod, y = n, fill = !!as.name(fill_column))) +
    geom_bar(position = "fill", stat = "identity", color = "black", width = 0.6) +
    geom_text(aes(label = label), position = position_fill(vjust = 0.5), size = 3, color = "black") +
    coord_flip() +
    theme_classic() +
    theme(legend.position = "top",
          axis.title.x = element_blank(),
          axis.title.y = element_blank()) +
    labs(fill = "") +
    scale_fill_manual(values = fill_palette) +
    scale_y_continuous(labels = function(x) paste0(x * 100, "%"))+
    guides(fill = guide_legend(reverse = TRUE))
}

#función base descriptivos
proc_plot_demo <- function(x, variable, demografico) {
  x %>%
    mutate({{ variable }} := to_label({{ variable }})) %>%
    group_by({{ demografico }}) %>%
    count({{ variable }}) %>%
    mutate(prop = round(n / sum(n) * 100, 0),
           ola = "Ola 0 (Septiembre-Noviembre 2023)",
           label=ifelse(prop>9,paste0(prop,"%"),NA))
}




data_ola0 <- readRDS("../data/esep_w0.rds") |>
  janitor::clean_names()|>
   rename(
         edad=edad_encuestado
         )|>
   mutate(edad_recod=case_when(edad <= 25 ~ "25 años o menos",
                              edad > 25 & edad <= 40 ~ "Entre 26 y 40 años",
                              edad > 40 & edad <= 60 ~ "Entre 41 y 60 años",
                              edad > 60 ~ "Más de 60 años"),
          region=paste0(toupper(substr(region, 1, 1)),tolower(substr(region, 2, nchar(region)))),
          zona=case_when(
            region%in%c("Arica y parinacota","Tarapacá","Antofagasta")~"Norte Grande",
            region%in%c("Coquimbo","Atacama")~"Norte Chico",
            region=="Metropolitana"~"Región Metropolitina",
            region%in%c("Valparaíso","Libertador bernardo o’higgins",
                        "Maule","Ñuble")~"Zona Central",
            region%in%c("Biobío","Araucanía","Los lagos","Los ríos")~"Zona Sur",
            region%in%c("Aysén","Magallanes")~"Zona Austral"
          ),
          zona=factor(zona,levels = c("Norte Grande",
                                      "Norte Chico",
                                      "Región Metropolitina",
                                      "Zona Central",
                                      "Zona Sur",
                                      "Zona Austral")),
          gse_recod=case_when(
            gse%in%c(6,5)~"E/D",
            gse%in%c(4,3)~"C2/C3",
            gse%in%c(2,1)~"ABC1/C1",
            gse==7~"Sin Info."
          ),
          sexo=to_label(sexo)
        ) 
```

## Qué es OLES?

::: columns
::: column
OLES agrupa investigadores/as de diferentes disciplinas y universidades en Chile con el objetivo de contribuir a la comprensión de los mecanismos de legitimidad policial y justificación de la violencia mediante el desarrollo de investigaciones bajo criterios de Ciencia Abierta y en diálogo con actores sociales.
:::

::: column
OLES cuenta de financiamiento y alianzas con las siguientes instituciones

::: {layout-ncol="2"}
![](img/oles_coes.png) ![](img/oles_uahc.png) ![](img/oles_udp.png)
:::
:::
:::

## Marco teórico
### Legitimidad Social: ¿Qué es y por qué importa?

<center>

![](img/confianza_carabineros.png).
</center>

Fuente: Centro de Estudios Públicos (CEP)

## Marco teórico
### Legitimidad Social: ¿Qué es y por qué importa?

::: columns
::: column
- Creencia en el derecho de las policías de ejercer su poder y dictar el comportamiento apropiado (Tyler & Jackson, 2013; Jackson, 2018)

:::

::: column
- Percepción de coincidencia entre los valores de la ciudadanía y los valores de las policías
- Creencia de que existe la obligación de obedecer a las policías

:::
:::

## Marco teórico
### Legitimidad Social: ¿Qué es y por qué importa?

<center>

![](img/legitimidad.png).
</center>

## Marco teórico
### ¿Cómo lograr legitimidad social?

<center>

![](img/jp_legitimidad.png).
</center>

## Marco teórico
### ¿Qué es la Justicia Procedimental?

::: columns
::: column
- Percepción de que las autoridades operan según procedimientos neutros y tratan a la ciudadanía de manera justa y respetuosa 
(Tyler & Blader, 2000)


:::

::: column
- Foco en las interacciones entre las policías y la ciudadanía

:::
:::

## Marco teórico
### Justicia procedimental

<center>

![](img/jp.png).
</center>



## Hitos Enero-Febrero

Acá añadir un punteo de hitos relevantes del trabajo de Ismael.

## Ficha técnica del Estudio

```{r}
readxl::read_xlsx(path = file.path('../data/tablas_manual.xlsx'), 
                         sheet = 'ficha') |>
  
  kbl(booktabs = TRUE) |>
    kable_styling(latex_options = c("repeat_header","hold_position"),
                bootstrap_options = "bordered",full_width = T) |>
  kable_classic_2()
```

# Percepción de seguridad {.r-fit-text background-image="img/oles_delincuencia.jpg"}

------------------------------------------------------------------------

#### Pensando en la delincuencia, usted diría que durante los últimos 12 meses la delincuencia en el país...

```{r}
#| label: fig-b1-long
#| fig-cap: "Pensando en la delincuencia, usted diría que durante los últimos 12 meses la delincuencia en el país..."
#| echo: false
#| warning: false

val_label(data_ola0$b1,99)<-"NS-NR"
val_label(data_ola0$b1,88)<-"NS-NR"

data_ola0 |>
    mutate(
    b1=to_label(b1)
    )|>
  count(b1) |>
  mutate(prop=(n/nrow(data_ola0)*100)|>round(1),
         ola="Ola 0 (Septiembre-Noviembre 2023)"
         )|>

  ggplot(aes(x=ola,y=prop,color=b1))+
  
  geom_point()+
  geom_line()+
  geom_text_repel(aes(label = paste0(prop,"%")))+
  mdthemes::md_theme_classic() +
  scale_y_continuous(labels = function(x) paste0(x, "%"),limits = c(0,100))+
  theme(
    legend.position = c(.95, .95),
    legend.justification = c("right", "top"),
    legend.box.just = "right",
    legend.margin = margin(6, 6, 6, 6),
    axis.title.x = element_blank(),
    axis.title.y = element_blank()
    )+
  labs(
    caption = "Fuente: ESEP 2023, ola 0.",
    color="Respuesta"
  )+
  scale_color_manual(values = palette_oles_4)
```

------------------------------------------------------------------------

#### ¿Qué tan seguro/a se siente caminando solo/a por su barrio cuando ya está oscuro?

```{r}
#| label: fig-b2-long
#| fig-cap: "¿Qué tan seguro/a se siente caminando solo/a por su barrio cuando ya está oscuro?"
#| echo: false
#| warning: false

val_label(data_ola0$b2,99)<-"NS-NR"
val_label(data_ola0$b2,88)<-"NS-NR"

data_ola0 |>
  mutate(b2=to_label(b2),
         b2=dplyr::recode(b2,"Muy inseguro/a" = "Inseguro/a + Muy inseguro/a",
                             "Inseguro/a" = "Inseguro/a + Muy inseguro/a",
                             "Seguro/a" = "Seguro/a + Muy seguro/a",
                             "Muy seguro/a" = "Seguro/a + Muy seguro/a")) |>
  count(b2) |> 
  mutate(prop=(n/nrow(data_ola0)*100)|>round(1),
         ola="Ola 0 (Septiembre-Noviembre 2023)") |>
  filter(b2!="No sabe (No leer)") |>
  filter(b2!="No responde (No leer)") |>

ggplot(aes(x=ola,y=prop,color=b2))+
  geom_point()+
  geom_line()+
  geom_text_repel(aes(label = paste0(prop,"%")))+
  scale_y_continuous(labels = function(x) paste0(x, "%"),limits = c(0,100))+
  mdthemes::md_theme_classic() +
  theme(
    legend.position = c(.95, .70),
    legend.justification = c("right", "top"),
    legend.box.just = "right",
    legend.margin = margin(6, 6, 6, 6),
    axis.title.x = element_blank(),
    axis.title.y = element_blank(),
    legend.key.size = unit(0.5, "lines"),
    legend.key.width = unit(0.5, "lines")
    )+
  labs(
    caption = "Fuente: ESEP 2023, ola 0.",
    color="Respuesta"
  ) +
  scale_color_manual(values = palette_oles_3)
```
```{r}
#| label: fig-b2-demo
#| fig-cap: "¿Qué tan seguro/a se siente caminando solo/a por su barrio cuando ya está oscuro? (Cruce demográfico)"
#| echo: false
#| warning: false

ggarrange(

data_ola0 |> 
  proc_plot_demo(b2,sexo)|>
  mutate(b2=factor(b2,
                   levels=c("Muy inseguro/a",
                            "Inseguro/a",
                            "Seguro/a",
                            "Muy seguro/a",
                            "NS-NR"))) |>
  plot_propbar_sexo(fill_column="b2",fill_palette=palette_oles_5),


data_ola0 |> 
  proc_plot_demo(b2,edad_recod)|>
  mutate(b2=factor(b2,
                   levels=c("Muy inseguro/a",
                            "Inseguro/a",
                            "Seguro/a",
                            "Muy seguro/a",
                            "NS-NR"))) |>
  plot_propbar_edad(fill_column = "b2",fill_palette = palette_oles_5),

data_ola0 |>
  proc_plot_demo(b2,zona)|>
  mutate(b2=factor(b2,
                   levels=c("Muy inseguro/a",
                            "Inseguro/a",
                            "Seguro/a",
                            "Muy seguro/a",
                            "NS-NR"))) |> 
  plot_propbar_zona(fill_column = "b2",fill_palette = palette_oles_5),

 data_ola0 |>
  proc_plot_demo(b2,gse_recod)|>
  mutate(b2=factor(b2,
                   levels=c("Muy inseguro/a",
                            "Inseguro/a",
                            "Seguro/a",
                            "Muy seguro/a",
                            "NS-NR"))) |>
  plot_propbar_gse(fill_column = "b2",fill_palette = palette_oles_5),

ncol = 2, nrow = 2, align = "hv", 
          common.legend = TRUE
)|>
  annotate_figure(bottom=text_grob("Fuente: ESEP 2023, ola 0.",hjust = 1,x=1,size = 10))
```

# Legitimidad de carabineros {.r-fit-text background-image="img/oles_carabineros.webp"}

------------------------------------------------------------------------

#### Teniendo en cuenta su propia experiencia o lo que ha oído, ¿en qué medida se encuentra Ud. de acuerdo o en desacuerdo con las siguientes afirmaciones sobre Carabineros de Chile?

```{r}
#| label: fig-c-general
#| fig-cap: "Teniendo en cuenta su propia experiencia o lo que ha oído, ¿en qué medida se encuentra Ud. de acuerdo o en desacuerdo con las siguientes afirmaciones sobre Carabineros de Chile?"
#| fig-subcap:
#|   - "Carabineros logra controlar el problema de la delincuencia en Chile"
#|   - "Carabineros logra controlar el problema del narcotráfico en Chile"
#|   - "En general, Los carabineros tienen la misma idea que yo sobre lo que está bien y lo que está mal"
#|   - "Hay que respetar las decisiones que toman los carabineros, aunque no se esté de acuerdo con ellas"
#| layout-ncol: 2
#| echo: false
#| warning: false

val_label(data_ola0$c1_1,99)<-"NS-NR"
val_label(data_ola0$c1_1,88)<-"NS-NR"

data_ola0 |>
  mutate(c1_1=to_label(c1_1))|>
  count(Variable=c1_1)|>
  mutate(prop=(n/nrow(data_ola0)*100)|>round(1),
         Item="Carabineros logra controlar el problema de la delincuencia en Chile")|>
  
  ggplot(aes(x=Variable,y=prop,fill=Variable))+
  geom_bar(position="dodge", stat="identity",color="black") +
  geom_text(aes(label=paste0(prop,"%")),
            hjust=-0.1) +
  md_theme_classic() +
  theme(legend.position="top",
        axis.title.x = element_blank(),
        axis.title.y = element_blank())+
  scale_y_continuous(labels = function(x) paste0(x, "%"),limits = c(0,100))+
  scale_fill_manual(values = palette_oles_6)+
  coord_flip() +
  guides(fill=FALSE)+
  labs(caption = "[Proporción de casos perdidos = 0.30%]")

val_label(data_ola0$c1_2,99)<-"NS-NR"
val_label(data_ola0$c1_2,88)<-"NS-NR"

data_ola0 |>
  count(Variable=to_label(c1_2))|>
  mutate(prop=(n/nrow(data_ola0)*100)|>round(1),
         Item="Carabineros logra controlar el problema del narcotráfico en Chile")|>
  mutate(Item=str_wrap(Item, width = 60)) |>

  ggplot(aes(x=Variable,y=prop,fill=Variable))+
  geom_bar(position="dodge", stat="identity",color="black") +
  geom_text(aes(label=paste0(prop,"%")),
            hjust=-0.1) +
  md_theme_classic() +
  theme(legend.position="top",
        axis.title.x = element_blank(),
        axis.title.y = element_blank())+
  scale_y_continuous(labels = function(x) paste0(x, "%"),limits = c(0,100))+
  scale_fill_manual(values = palette_oles_6)+
  coord_flip() +
  guides(fill=FALSE)+
  labs(caption = "[Proporción de casos perdidos = 0.60%]")

val_label(data_ola0$c1_3,99)<-"NS-NR"
val_label(data_ola0$c1_3,88)<-"NS-NR"

data_ola0 |>
  count(Variable=to_label(c1_3))|>
  mutate(prop=(n/nrow(data_ola0)*100)|>round(1),
         Item="En general, los carabineros tienen la misma idea que yo sobre lo que está bien y lo que está mal")|>
  mutate(Item=str_wrap(Item, width = 60)) |>

  ggplot(aes(x=Variable,y=prop,fill=Variable))+
  geom_bar(position="dodge", stat="identity",color="black") +
  geom_text(aes(label=paste0(prop,"%")),
            hjust=-0.1) +
  md_theme_classic() +
  theme(legend.position="top",
        axis.title.x = element_blank(),
        axis.title.y = element_blank())+
  scale_y_continuous(labels = function(x) paste0(x, "%"),limits = c(0,100))+
  coord_flip() +
  scale_fill_manual(values = palette_oles_6)+
  guides(fill=FALSE)+
  labs(caption = "[Proporción de casos perdidos = 1.90%]")


data_ola0 <- data_ola0 %>%
  mutate(c1_4 = if_else(is.na(c1_4), 99, c1_4))

val_label(data_ola0$c1_4,99)<-"NS-NR"
val_label(data_ola0$c1_4,88)<-"NS-NR"

# Falta arreglar la introducción de NA
data_ola0 |>
  count(Variable=to_label(c1_4))|>
  group_by(Variable)|>
  summarise(n=sum(n))|>
  ungroup()|>
  mutate(prop=(n/nrow(data_ola0)*100)|>round(1),
         Item="Hay que respetar las decisiones que toman los carabineros, aunque no se esté de acuerdo con ellas")|>
  mutate(Item=str_wrap(Item, width = 60)) |>

  ggplot(aes(x=Variable,y=prop,fill=Variable))+
  geom_bar(position="dodge", stat="identity",color="black") +
  geom_text(aes(label=paste0(prop,"%")),
            hjust=-0.1) +
  md_theme_classic() +
  theme(legend.position="top",
        axis.title.x = element_blank(),
        axis.title.y = element_blank())+
  scale_y_continuous(labels = function(x) paste0(x, "%"),limits = c(0,100))+
  coord_flip() +
  scale_fill_manual(values = palette_oles_6)+
  guides(fill=FALSE)+
  labs(caption = "[Proporción de casos perdidos = 0.30%]")

```
------------------------------------------------------------------------


#### Teniendo en cuenta su propia experiencia o lo que ha oído, ¿con qué frecuencia cree Ud. que los carabineros...?

-   La población en Chile tiende a preferir las posiciones intermedias a la hora de juzgar la frecuencia en que las decisiones de carabineros son justas e imparciales.
-   La población en Chile considera que los carabineros tiende a tener más tratos respuestos que irrespetuosos.

```{r}
rbind(
data_ola0 |>
  count(Variable=to_label(c2_1))|>
  mutate(prop=(n/nrow(data_ola0)*100)|>round(2),
         Item="tratan a las personas con respeto en Chile"),
data_ola0 |>
  count(Variable=to_label(c2_2)) |>
  mutate(prop=(n/nrow(data_ola0)*100)|>round(2),
         Item="Toman decisiones justas e imparciales en los casos que se ocupa?")
) |>

filter(Variable!="No sabe (No leer)") |>
filter(Variable!="No responde (No leer)") |>
  
mutate(Item=str_wrap(Item, width = 60)) |>
  
  ggplot(aes(x=Variable,y=prop,fill=Variable))+
  geom_bar(position="dodge", stat="identity",color="black") +
  facet_wrap(~Item,ncol = 1) +
  mdthemes::md_theme_classic(base_size = 12) +
  theme(legend.position="top",
        axis.title.x = element_blank(),
        axis.title.y = element_blank())+
  scale_y_continuous(labels = function(x) paste0(x, "%"))+
  geom_text(aes(label=paste0(prop,"%"),vjust=-0.2)) +
  scale_fill_manual(values = palette_likert_5)+
  guides(fill=FALSE)
```

# Legitimidad de Policía de Investigaciones {.r-fit-text background-image="img/oles_pdi.jpg"}


